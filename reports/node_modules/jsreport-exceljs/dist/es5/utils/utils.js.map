{"version":3,"file":"utils.js","names":["fs","require","inherits","cls","superCtor","statics","prototype","super_","Object","keys","forEach","i","defineProperty","getOwnPropertyDescriptor","properties","constructor","value","enumerable","writable","configurable","create","utils","nop","promiseImmediate","Promise","resolve","global","setImmediate","setTimeout","dateToExcel","d","date1904","getTime","excelToDate","v","millisecondSinceEpoch","Math","round","Date","parsePath","filepath","last","lastIndexOf","path","substring","name","getRelsPath","xmlEncode","text","replace","c","xmlDecode","validInt","parseInt","Number","isNaN","isDateFmt","fmt","result","match","exists","access","constants","F_OK","err","toIsoDateString","dt","toIsoString","subsstr","module","exports"],"sources":["../../../lib/utils/utils.js"],"sourcesContent":["const fs = require('fs');\n\n// useful stuff\nconst inherits = function(cls, superCtor, statics, prototype) {\n  // eslint-disable-next-line no-underscore-dangle\n  cls.super_ = superCtor;\n\n  if (!prototype) {\n    prototype = statics;\n    statics = null;\n  }\n\n  if (statics) {\n    Object.keys(statics).forEach(i => {\n      Object.defineProperty(cls, i, Object.getOwnPropertyDescriptor(statics, i));\n    });\n  }\n\n  const properties = {\n    constructor: {\n      value: cls,\n      enumerable: false,\n      writable: false,\n      configurable: true,\n    },\n  };\n  if (prototype) {\n    Object.keys(prototype).forEach(i => {\n      properties[i] = Object.getOwnPropertyDescriptor(prototype, i);\n    });\n  }\n\n  cls.prototype = Object.create(superCtor.prototype, properties);\n};\n\nconst utils = {\n  nop() {},\n  promiseImmediate(value) {\n    return new Promise(resolve => {\n      if (global.setImmediate) {\n        setImmediate(() => {\n          resolve(value);\n        });\n      } else {\n        // poorman's setImmediate - must wait at least 1ms\n        setTimeout(() => {\n          resolve(value);\n        }, 1);\n      }\n    });\n  },\n  inherits,\n  dateToExcel(d, date1904) {\n    return 25569 + (d.getTime() / (24 * 3600 * 1000)) - (date1904 ? 1462 : 0);\n  },\n  excelToDate(v, date1904) {\n    const millisecondSinceEpoch = Math.round((v - 25569 + (date1904 ? 1462 : 0)) * 24 * 3600 * 1000);\n    return new Date(millisecondSinceEpoch);\n  },\n  parsePath(filepath) {\n    const last = filepath.lastIndexOf('/');\n    return {\n      path: filepath.substring(0, last),\n      name: filepath.substring(last + 1),\n    };\n  },\n  getRelsPath(filepath) {\n    const path = utils.parsePath(filepath);\n    return `${path.path}/_rels/${path.name}.rels`;\n  },\n  xmlEncode(text) {\n    // eslint-disable-next-line no-control-regex\n    return text.replace(/[<>&'\"\\x7F\\x00-\\x08\\x0B-\\x0C\\x0E-\\x1F]/g, c => {\n      switch (c) {\n        case '<':\n          return '&lt;';\n        case '>':\n          return '&gt;';\n        case '&':\n          return '&amp;';\n        case '\\'':\n          return '&apos;';\n        case '\"':\n          return '&quot;';\n        default:\n          return '';\n      }\n    });\n  },\n  xmlDecode(text) {\n    return text.replace(/&([a-z]*);/, c => {\n      switch (c) {\n        case '&lt;':\n          return '<';\n        case '&gt;':\n          return '>';\n        case '&amp;':\n          return '&';\n        case '&apos;':\n          return '\\'';\n        case '&quot;':\n          return '\"';\n        default:\n          return c;\n      }\n    });\n  },\n  validInt(value) {\n    const i = parseInt(value, 10);\n    return !Number.isNaN(i) ? i : 0;\n  },\n\n  isDateFmt(fmt) {\n    if (!fmt) {\n      return false;\n    }\n\n    // must remove all chars inside quotes and []\n    fmt = fmt.replace(/\\[[^\\]]*]/g, '');\n    fmt = fmt.replace(/\"[^\"]*\"/g, '');\n    // then check for date formatting chars\n    const result = fmt.match(/[ymdhMsb]+/) !== null;\n    return result;\n  },\n\n  fs: {\n    exists(path) {\n      return new Promise(resolve => {\n        fs.access(path, fs.constants.F_OK, err => {\n          resolve(!err);\n        });\n      });\n    },\n  },\n\n  toIsoDateString(dt) {\n    return dt.toIsoString().subsstr(0, 10);\n  },\n};\n\nmodule.exports = utils;\n"],"mappings":"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"}