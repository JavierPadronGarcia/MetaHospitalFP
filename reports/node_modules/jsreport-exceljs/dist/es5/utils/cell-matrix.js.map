{"version":3,"file":"cell-matrix.js","names":["_","require","colCache","CellMatrix","template","sheets","addressStr","addCellEx","decodeEx","findCellEx","sheetName","rowNumber","colNumber","sheet","row","address","top","bottom","col","left","right","getCellAt","create","findSheet","findSheetRow","findRowCell","cell","n2l","callback","forEach","each","forEachInSheet","results","push","name","undefined","Object","assign","JSON","parse","stringify","start","numDelete","numInsert","inserts","i","splice","module","exports"],"sources":["../../../lib/utils/cell-matrix.js"],"sourcesContent":["const _ = require('./under-dash');\nconst colCache = require('./col-cache');\n\nclass CellMatrix {\n  constructor(template) {\n    this.template = template;\n    this.sheets = {};\n  }\n\n  addCell(addressStr) {\n    this.addCellEx(colCache.decodeEx(addressStr));\n  }\n\n  getCell(addressStr) {\n    return this.findCellEx(colCache.decodeEx(addressStr), true);\n  }\n\n  findCell(addressStr) {\n    return this.findCellEx(colCache.decodeEx(addressStr), false);\n  }\n\n\n  findCellAt(sheetName, rowNumber, colNumber) {\n    const sheet = this.sheets[sheetName];\n    const row = sheet && sheet[rowNumber];\n    return row && row[colNumber];\n  }\n\n  addCellEx(address) {\n    if (address.top) {\n      for (let row = address.top; row <= address.bottom; row++) {\n        for (let col = address.left; col <= address.right; col++) {\n          this.getCellAt(address.sheetName, row, col);\n        }\n      }\n    } else {\n      this.findCellEx(address, true);\n    }\n  }\n\n  getCellEx(address) {\n    return this.findCellEx(address, true);\n  }\n\n  findCellEx(address, create) {\n    const sheet = this.findSheet(address, create);\n    const row = this.findSheetRow(sheet, address, create);\n    return this.findRowCell(row, address, create);\n  }\n\n  getCellAt(sheetName, rowNumber, colNumber) {\n    const sheet = this.sheets[sheetName] || (this.sheets[sheetName] = []);\n    const row = sheet[rowNumber] || (sheet[rowNumber] = []);\n    const cell =\n      row[colNumber] ||\n      (row[colNumber] = {\n        sheetName,\n        address: colCache.n2l(colNumber) + rowNumber,\n        row: rowNumber,\n        col: colNumber,\n      });\n    return cell;\n  }\n\n  removeCellEx(address) {\n    const sheet = this.findSheet(address);\n    if (!sheet) {\n      return;\n    }\n    const row = this.findSheetRow(sheet, address);\n    if (!row) {\n      return;\n    }\n    delete row[address.col];\n  }\n\n  forEachInSheet(sheetName, callback) {\n    const sheet = this.sheets[sheetName];\n    if (sheet) {\n      sheet.forEach((row, rowNumber) => {\n        if (row) {\n          row.forEach((cell, colNumber) => {\n            if (cell) {\n              callback(cell, rowNumber, colNumber);\n            }\n          });\n        }\n      });\n    }\n  }\n\n  forEach(callback) {\n    _.each(this.sheets, (sheet, sheetName) => {\n      this.forEachInSheet(sheetName, callback);\n    });\n  }\n\n  map(callback) {\n    const results = [];\n    this.forEach(cell => {\n      results.push(callback(cell));\n    });\n    return results;\n  }\n\n  findSheet(address, create) {\n    const name = address.sheetName;\n    if (this.sheets[name]) {\n      return this.sheets[name];\n    }\n    if (create) {\n      return (this.sheets[name] = []);\n    }\n    return undefined;\n  }\n\n  findSheetRow(sheet, address, create) {\n    const {row} = address;\n    if (sheet && sheet[row]) {\n      return sheet[row];\n    }\n    if (create) {\n      return (sheet[row] = []);\n    }\n    return undefined;\n  }\n\n  findRowCell(row, address, create) {\n    const {col} = address;\n    if (row && row[col]) {\n      return row[col];\n    }\n    if (create) {\n      return (row[col] = this.template ? Object.assign(address, JSON.parse(JSON.stringify(this.template))) : address);\n    }\n    return undefined;\n  }\n\n  spliceRows(sheetName, start, numDelete, numInsert) {\n    const sheet = this.sheets[sheetName];\n    if (sheet) {\n      const inserts = [];\n      for (let i = 0; i < numInsert; i++) {\n        inserts.push([]);\n      }\n      sheet.splice(start, numDelete, ...inserts);\n    }\n  }\n\n  spliceColumns(sheetName, start, numDelete, numInsert) {\n    const sheet = this.sheets[sheetName];\n    if (sheet) {\n      const inserts = [];\n      for (let i = 0; i < numInsert; i++) {\n        inserts.push(null);\n      }\n      _.each(sheet, row => {\n        row.splice(start, numDelete, ...inserts);\n      });\n    }\n  }\n}\n\nmodule.exports = CellMatrix;\n"],"mappings":"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"}