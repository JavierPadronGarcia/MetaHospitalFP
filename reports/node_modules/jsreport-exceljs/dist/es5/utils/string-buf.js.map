{"version":3,"file":"string-buf.js","names":["StringBuf","options","_buf","Buffer","alloc","size","_encoding","encoding","_inPos","_buffer","undefined","length","copy","position","min","buf","text","inPos","write","_grow","inBuf","capacity","module","exports"],"sources":["../../../lib/utils/string-buf.js"],"sourcesContent":["// StringBuf - a way to keep string memory operations to a minimum\n// while building the strings for the xml files\nclass StringBuf {\n  constructor(options) {\n    this._buf = Buffer.alloc((options && options.size) || 16384);\n    this._encoding = (options && options.encoding) || 'utf8';\n\n    // where in the buffer we are at\n    this._inPos = 0;\n\n    // for use by toBuffer()\n    this._buffer = undefined;\n  }\n\n  get length() {\n    return this._inPos;\n  }\n\n  get capacity() {\n    return this._buf.length;\n  }\n\n  get buffer() {\n    return this._buf;\n  }\n\n  toBuffer() {\n    // return the current data as a single enclosing buffer\n    if (!this._buffer) {\n      this._buffer = Buffer.alloc(this.length);\n      this._buf.copy(this._buffer, 0, 0, this.length);\n    }\n    return this._buffer;\n  }\n\n  reset(position) {\n    position = position || 0;\n    this._buffer = undefined;\n    this._inPos = position;\n  }\n\n  _grow(min) {\n    let size = this._buf.length * 2;\n    while (size < min) {\n      size *= 2;\n    }\n    const buf = Buffer.alloc(size);\n    this._buf.copy(buf, 0);\n    this._buf = buf;\n  }\n\n  addText(text) {\n    this._buffer = undefined;\n\n    let inPos = this._inPos + this._buf.write(text, this._inPos, this._encoding);\n\n    // if we've hit (or nearing capacity), grow the buf\n    while (inPos >= this._buf.length - 4) {\n      this._grow(this._inPos + text.length);\n\n      // keep trying to write until we've completely written the text\n      inPos = this._inPos + this._buf.write(text, this._inPos, this._encoding);\n    }\n\n    this._inPos = inPos;\n  }\n\n  addStringBuf(inBuf) {\n    if (inBuf.length) {\n      this._buffer = undefined;\n\n      if (this.length + inBuf.length > this.capacity) {\n        this._grow(this.length + inBuf.length);\n      }\n      // eslint-disable-next-line no-underscore-dangle\n      inBuf._buf.copy(this._buf, this._inPos, 0, inBuf.length);\n      this._inPos += inBuf.length;\n    }\n  }\n}\n\nmodule.exports = StringBuf;\n"],"mappings":";;;;;;;;AAAA;AACA;IACMA,S;EACJ,mBAAYC,OAAZ,EAAqB;IAAA;;IACnB,KAAKC,IAAL,GAAYC,MAAM,CAACC,KAAP,CAAcH,OAAO,IAAIA,OAAO,CAACI,IAApB,IAA6B,KAA1C,CAAZ;IACA,KAAKC,SAAL,GAAkBL,OAAO,IAAIA,OAAO,CAACM,QAApB,IAAiC,MAAlD,CAFmB,CAInB;;IACA,KAAKC,MAAL,GAAc,CAAd,CALmB,CAOnB;;IACA,KAAKC,OAAL,GAAeC,SAAf;EACD;;;;SAED,eAAa;MACX,OAAO,KAAKF,MAAZ;IACD;;;SAED,eAAe;MACb,OAAO,KAAKN,IAAL,CAAUS,MAAjB;IACD;;;SAED,eAAa;MACX,OAAO,KAAKT,IAAZ;IACD;;;WAED,oBAAW;MACT;MACA,IAAI,CAAC,KAAKO,OAAV,EAAmB;QACjB,KAAKA,OAAL,GAAeN,MAAM,CAACC,KAAP,CAAa,KAAKO,MAAlB,CAAf;;QACA,KAAKT,IAAL,CAAUU,IAAV,CAAe,KAAKH,OAApB,EAA6B,CAA7B,EAAgC,CAAhC,EAAmC,KAAKE,MAAxC;MACD;;MACD,OAAO,KAAKF,OAAZ;IACD;;;WAED,eAAMI,QAAN,EAAgB;MACdA,QAAQ,GAAGA,QAAQ,IAAI,CAAvB;MACA,KAAKJ,OAAL,GAAeC,SAAf;MACA,KAAKF,MAAL,GAAcK,QAAd;IACD;;;WAED,eAAMC,GAAN,EAAW;MACT,IAAIT,IAAI,GAAG,KAAKH,IAAL,CAAUS,MAAV,GAAmB,CAA9B;;MACA,OAAON,IAAI,GAAGS,GAAd,EAAmB;QACjBT,IAAI,IAAI,CAAR;MACD;;MACD,IAAMU,GAAG,GAAGZ,MAAM,CAACC,KAAP,CAAaC,IAAb,CAAZ;;MACA,KAAKH,IAAL,CAAUU,IAAV,CAAeG,GAAf,EAAoB,CAApB;;MACA,KAAKb,IAAL,GAAYa,GAAZ;IACD;;;WAED,iBAAQC,IAAR,EAAc;MACZ,KAAKP,OAAL,GAAeC,SAAf;;MAEA,IAAIO,KAAK,GAAG,KAAKT,MAAL,GAAc,KAAKN,IAAL,CAAUgB,KAAV,CAAgBF,IAAhB,EAAsB,KAAKR,MAA3B,EAAmC,KAAKF,SAAxC,CAA1B,CAHY,CAKZ;;;MACA,OAAOW,KAAK,IAAI,KAAKf,IAAL,CAAUS,MAAV,GAAmB,CAAnC,EAAsC;QACpC,KAAKQ,KAAL,CAAW,KAAKX,MAAL,GAAcQ,IAAI,CAACL,MAA9B,EADoC,CAGpC;;;QACAM,KAAK,GAAG,KAAKT,MAAL,GAAc,KAAKN,IAAL,CAAUgB,KAAV,CAAgBF,IAAhB,EAAsB,KAAKR,MAA3B,EAAmC,KAAKF,SAAxC,CAAtB;MACD;;MAED,KAAKE,MAAL,GAAcS,KAAd;IACD;;;WAED,sBAAaG,KAAb,EAAoB;MAClB,IAAIA,KAAK,CAACT,MAAV,EAAkB;QAChB,KAAKF,OAAL,GAAeC,SAAf;;QAEA,IAAI,KAAKC,MAAL,GAAcS,KAAK,CAACT,MAApB,GAA6B,KAAKU,QAAtC,EAAgD;UAC9C,KAAKF,KAAL,CAAW,KAAKR,MAAL,GAAcS,KAAK,CAACT,MAA/B;QACD,CALe,CAMhB;;;QACAS,KAAK,CAAClB,IAAN,CAAWU,IAAX,CAAgB,KAAKV,IAArB,EAA2B,KAAKM,MAAhC,EAAwC,CAAxC,EAA2CY,KAAK,CAACT,MAAjD;;QACA,KAAKH,MAAL,IAAeY,KAAK,CAACT,MAArB;MACD;IACF;;;;;;AAGHW,MAAM,CAACC,OAAP,GAAiBvB,SAAjB"}