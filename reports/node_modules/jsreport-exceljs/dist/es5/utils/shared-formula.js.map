{"version":3,"file":"shared-formula.js","names":["colCache","require","replacementCandidateRx","CRrx","slideFormula","formula","fromCell","toCell","offset","decode","to","replace","refMatch","sheet","sheetMaybe","addrPart","trailingParen","match","exec","colDollar","colStr","toUpperCase","rowDollar","rowStr","length","col","l2n","row","parseInt","res","n2l","module","exports"],"sources":["../../../lib/utils/shared-formula.js"],"sourcesContent":["const colCache = require('./col-cache');\n\n// const cellRefRegex = /(([a-z_\\-0-9]*)!)?[$]?([a-z]+)[$]?([1-9][0-9]*)/i;\nconst replacementCandidateRx = /(([a-z_\\-0-9]*)!)?([a-z0-9_$]{2,})([(])?/gi;\nconst CRrx = /^([$])?([a-z]+)([$])?([1-9][0-9]*)$/i;\n\nfunction slideFormula(formula, fromCell, toCell) {\n  const offset = colCache.decode(fromCell);\n  const to = colCache.decode(toCell);\n  return formula.replace(replacementCandidateRx, (refMatch, sheet, sheetMaybe, addrPart, trailingParen) => {\n    if (trailingParen) {\n      return refMatch;\n    }\n    const match = CRrx.exec(addrPart);\n    if (match) {\n      const colDollar = match[1];\n      const colStr = match[2].toUpperCase();\n      const rowDollar = match[3];\n      const rowStr = match[4];\n      if (colStr.length > 3 || (colStr.length === 3 && colStr > 'XFD')) {\n        // > XFD is the highest col number in excel 2007 and beyond, so this is a named range\n        return refMatch;\n      }\n      let col = colCache.l2n(colStr);\n      let row = parseInt(rowStr, 10);\n      if (!colDollar) {\n        col += to.col - offset.col;\n      }\n      if (!rowDollar) {\n        row += to.row - offset.row;\n      }\n      const res = (sheet || '') + (colDollar || '') + colCache.n2l(col) + (rowDollar || '') + row;\n      return res;\n    }\n    return refMatch;\n  });\n}\n\nmodule.exports = {\n  slideFormula,\n};\n"],"mappings":";;AAAA,IAAMA,QAAQ,GAAGC,OAAO,CAAC,aAAD,CAAxB,C,CAEA;;;AACA,IAAMC,sBAAsB,GAAG,4CAA/B;AACA,IAAMC,IAAI,GAAG,sCAAb;;AAEA,SAASC,YAAT,CAAsBC,OAAtB,EAA+BC,QAA/B,EAAyCC,MAAzC,EAAiD;EAC/C,IAAMC,MAAM,GAAGR,QAAQ,CAACS,MAAT,CAAgBH,QAAhB,CAAf;EACA,IAAMI,EAAE,GAAGV,QAAQ,CAACS,MAAT,CAAgBF,MAAhB,CAAX;EACA,OAAOF,OAAO,CAACM,OAAR,CAAgBT,sBAAhB,EAAwC,UAACU,QAAD,EAAWC,KAAX,EAAkBC,UAAlB,EAA8BC,QAA9B,EAAwCC,aAAxC,EAA0D;IACvG,IAAIA,aAAJ,EAAmB;MACjB,OAAOJ,QAAP;IACD;;IACD,IAAMK,KAAK,GAAGd,IAAI,CAACe,IAAL,CAAUH,QAAV,CAAd;;IACA,IAAIE,KAAJ,EAAW;MACT,IAAME,SAAS,GAAGF,KAAK,CAAC,CAAD,CAAvB;MACA,IAAMG,MAAM,GAAGH,KAAK,CAAC,CAAD,CAAL,CAASI,WAAT,EAAf;MACA,IAAMC,SAAS,GAAGL,KAAK,CAAC,CAAD,CAAvB;MACA,IAAMM,MAAM,GAAGN,KAAK,CAAC,CAAD,CAApB;;MACA,IAAIG,MAAM,CAACI,MAAP,GAAgB,CAAhB,IAAsBJ,MAAM,CAACI,MAAP,KAAkB,CAAlB,IAAuBJ,MAAM,GAAG,KAA1D,EAAkE;QAChE;QACA,OAAOR,QAAP;MACD;;MACD,IAAIa,GAAG,GAAGzB,QAAQ,CAAC0B,GAAT,CAAaN,MAAb,CAAV;MACA,IAAIO,GAAG,GAAGC,QAAQ,CAACL,MAAD,EAAS,EAAT,CAAlB;;MACA,IAAI,CAACJ,SAAL,EAAgB;QACdM,GAAG,IAAIf,EAAE,CAACe,GAAH,GAASjB,MAAM,CAACiB,GAAvB;MACD;;MACD,IAAI,CAACH,SAAL,EAAgB;QACdK,GAAG,IAAIjB,EAAE,CAACiB,GAAH,GAASnB,MAAM,CAACmB,GAAvB;MACD;;MACD,IAAME,GAAG,GAAG,CAAChB,KAAK,IAAI,EAAV,KAAiBM,SAAS,IAAI,EAA9B,IAAoCnB,QAAQ,CAAC8B,GAAT,CAAaL,GAAb,CAApC,IAAyDH,SAAS,IAAI,EAAtE,IAA4EK,GAAxF;MACA,OAAOE,GAAP;IACD;;IACD,OAAOjB,QAAP;EACD,CA1BM,CAAP;AA2BD;;AAEDmB,MAAM,CAACC,OAAP,GAAiB;EACf5B,YAAY,EAAZA;AADe,CAAjB"}