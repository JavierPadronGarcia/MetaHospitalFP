{"version":3,"file":"cf-rule-ext-xform.js","names":["uuid","require","BaseXform","CompositeXform","DatabarExtXform","IconSetExtXform","extIcons","CfRuleExtXform","map","databarXform","iconSetXform","model","isExt","x14Id","v4","toUpperCase","xmlStream","type","renderDataBar","renderIconSet","openNode","tag","id","render","closeNode","priority","attributes","toIntValue","name","parser","Object","assign","rule","custom","iconSet","module","exports"],"sources":["../../../../../../lib/xlsx/xform/sheet/cf-ext/cf-rule-ext-xform.js"],"sourcesContent":["const uuid = require('uuid');\nconst BaseXform = require('../../base-xform');\nconst CompositeXform = require('../../composite-xform');\n\nconst DatabarExtXform = require('./databar-ext-xform');\nconst IconSetExtXform = require('./icon-set-ext-xform');\n\nconst extIcons = {\n  '3Triangles': true,\n  '3Stars': true,\n  '5Boxes': true,\n};\n\nclass CfRuleExtXform extends CompositeXform {\n  constructor() {\n    super();\n\n    this.map = {\n      'x14:dataBar': this.databarXform = new DatabarExtXform(),\n      'x14:iconSet': this.iconSetXform = new IconSetExtXform(),\n    };\n  }\n\n  get tag() {\n    return 'x14:cfRule';\n  }\n\n  static isExt(rule) {\n    // is this rule primitive?\n    if (rule.type === 'dataBar') {\n      return DatabarExtXform.isExt(rule);\n    }\n    if (rule.type === 'iconSet') {\n      if (rule.custom || extIcons[rule.iconSet]) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  prepare(model) {\n    if (CfRuleExtXform.isExt(model)) {\n      model.x14Id = `{${uuid.v4()}}`.toUpperCase();\n    }\n  }\n\n  render(xmlStream, model) {\n    if (!CfRuleExtXform.isExt(model)) {\n      return;\n    }\n\n    switch (model.type) {\n      case 'dataBar':\n        this.renderDataBar(xmlStream, model);\n        break;\n      case 'iconSet':\n        this.renderIconSet(xmlStream, model);\n        break;\n    }\n  }\n\n  renderDataBar(xmlStream, model) {\n    xmlStream.openNode(this.tag, {\n      type: 'dataBar',\n      id: model.x14Id,\n    });\n\n    this.databarXform.render(xmlStream, model);\n\n    xmlStream.closeNode();\n  }\n\n  renderIconSet(xmlStream, model) {\n    xmlStream.openNode(this.tag, {\n      type: 'iconSet',\n      priority: model.priority,\n      id: model.x14Id || `{${uuid.v4()}}`,\n    });\n\n    this.iconSetXform.render(xmlStream, model);\n\n    xmlStream.closeNode();\n  }\n\n  createNewModel({attributes}) {\n    return {\n      type: attributes.type,\n      x14Id: attributes.id,\n      priority: BaseXform.toIntValue(attributes.priority),\n    };\n  }\n\n  onParserClose(name, parser) {\n    Object.assign(this.model, parser.model);\n  }\n}\n\nmodule.exports = CfRuleExtXform;\n"],"mappings":"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"}