{"version":3,"file":"sheet-view-xform.js","names":["colCache","require","BaseXform","VIEW_STATES","frozen","frozenSplit","split","SheetViewXform","model","state","xmlStream","openNode","workbookViewId","add","name","value","included","addAttribute","rightToLeft","tabSelected","showRuler","showRowColHeaders","showGridLines","zoomScale","zoomScaleNormal","style","topLeftCell","xSplit","ySplit","activePane","getAddress","address","leafNode","undefined","pane","activeCell","sqref","closeNode","node","sheetView","parseInt","attributes","view","selections","selection","topLeft","module","exports"],"sources":["../../../../../lib/xlsx/xform/sheet/sheet-view-xform.js"],"sourcesContent":["const colCache = require('../../../utils/col-cache');\nconst BaseXform = require('../base-xform');\n\nconst VIEW_STATES = {\n  frozen: 'frozen',\n  frozenSplit: 'frozen',\n  split: 'split',\n};\n\nclass SheetViewXform extends BaseXform {\n  get tag() {\n    return 'sheetView';\n  }\n\n  prepare(model) {\n    switch (model.state) {\n      case 'frozen':\n      case 'split':\n        break;\n      default:\n        model.state = 'normal';\n        break;\n    }\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openNode('sheetView', {\n      workbookViewId: model.workbookViewId || 0,\n    });\n    const add = function(name, value, included) {\n      if (included) {\n        xmlStream.addAttribute(name, value);\n      }\n    };\n    add('rightToLeft', '1', model.rightToLeft === true);\n    add('tabSelected', '1', model.tabSelected);\n    add('showRuler', '0', model.showRuler === false);\n    add('showRowColHeaders', '0', model.showRowColHeaders === false);\n    add('showGridLines', '0', model.showGridLines === false);\n    add('zoomScale', model.zoomScale, model.zoomScale);\n    add('zoomScaleNormal', model.zoomScaleNormal, model.zoomScaleNormal);\n    add('view', model.style, model.style);\n\n    let topLeftCell;\n    let xSplit;\n    let ySplit;\n    let activePane;\n    switch (model.state) {\n      case 'frozen':\n        xSplit = model.xSplit || 0;\n        ySplit = model.ySplit || 0;\n        topLeftCell = model.topLeftCell || colCache.getAddress(ySplit + 1, xSplit + 1).address;\n        activePane = (model.xSplit && model.ySplit && 'bottomRight') || (model.xSplit && 'topRight') || 'bottomLeft';\n\n        xmlStream.leafNode('pane', {\n          xSplit: model.xSplit || undefined,\n          ySplit: model.ySplit || undefined,\n          topLeftCell,\n          activePane,\n          state: 'frozen',\n        });\n        xmlStream.leafNode('selection', {\n          pane: activePane,\n          activeCell: model.activeCell,\n          sqref: model.activeCell,\n        });\n        break;\n      case 'split':\n        if (model.activePane === 'topLeft') {\n          model.activePane = undefined;\n        }\n        xmlStream.leafNode('pane', {\n          xSplit: model.xSplit || undefined,\n          ySplit: model.ySplit || undefined,\n          topLeftCell: model.topLeftCell,\n          activePane: model.activePane,\n        });\n        xmlStream.leafNode('selection', {\n          pane: model.activePane,\n          activeCell: model.activeCell,\n          sqref: model.activeCell,\n        });\n        break;\n      case 'normal':\n        if (model.activeCell) {\n          xmlStream.leafNode('selection', {\n            activeCell: model.activeCell,\n            sqref: model.activeCell,\n          });\n        }\n        break;\n      default:\n        break;\n    }\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    switch (node.name) {\n      case 'sheetView':\n        this.sheetView = {\n          workbookViewId: parseInt(node.attributes.workbookViewId, 10),\n          rightToLeft: node.attributes.rightToLeft === '1',\n          tabSelected: node.attributes.tabSelected === '1',\n          showRuler: !(node.attributes.showRuler === '0'),\n          showRowColHeaders: !(node.attributes.showRowColHeaders === '0'),\n          showGridLines: !(node.attributes.showGridLines === '0'),\n          zoomScale: parseInt(node.attributes.zoomScale || '100', 10),\n          zoomScaleNormal: parseInt(node.attributes.zoomScaleNormal || '100', 10),\n          style: node.attributes.view,\n        };\n        this.pane = undefined;\n        this.selections = {};\n        return true;\n\n      case 'pane':\n        this.pane = {\n          xSplit: parseInt(node.attributes.xSplit || '0', 10),\n          ySplit: parseInt(node.attributes.ySplit || '0', 10),\n          topLeftCell: node.attributes.topLeftCell,\n          activePane: node.attributes.activePane || 'topLeft',\n          state: node.attributes.state,\n        };\n        return true;\n\n      case 'selection': {\n        const name = node.attributes.pane || 'topLeft';\n        this.selections[name] = {\n          pane: name,\n          activeCell: node.attributes.activeCell,\n        };\n        return true;\n      }\n\n      default:\n        return false;\n    }\n  }\n\n  parseText() {}\n\n  parseClose(name) {\n    let model;\n    let selection;\n    switch (name) {\n      case 'sheetView':\n        if (this.sheetView && this.pane) {\n          model = this.model = {\n            workbookViewId: this.sheetView.workbookViewId,\n            rightToLeft: this.sheetView.rightToLeft,\n            state: VIEW_STATES[this.pane.state] || 'split', // split is default\n            xSplit: this.pane.xSplit,\n            ySplit: this.pane.ySplit,\n            topLeftCell: this.pane.topLeftCell,\n            showRuler: this.sheetView.showRuler,\n            showRowColHeaders: this.sheetView.showRowColHeaders,\n            showGridLines: this.sheetView.showGridLines,\n            zoomScale: this.sheetView.zoomScale,\n            zoomScaleNormal: this.sheetView.zoomScaleNormal,\n          };\n          if (this.model.state === 'split') {\n            model.activePane = this.pane.activePane;\n          }\n          selection = this.selections[this.pane.activePane];\n          if (selection && selection.activeCell) {\n            model.activeCell = selection.activeCell;\n          }\n          if (this.sheetView.style) {\n            model.style = this.sheetView.style;\n          }\n        } else {\n          model = this.model = {\n            workbookViewId: this.sheetView.workbookViewId,\n            rightToLeft: this.sheetView.rightToLeft,\n            state: 'normal',\n            showRuler: this.sheetView.showRuler,\n            showRowColHeaders: this.sheetView.showRowColHeaders,\n            showGridLines: this.sheetView.showGridLines,\n            zoomScale: this.sheetView.zoomScale,\n            zoomScaleNormal: this.sheetView.zoomScaleNormal,\n          };\n          selection = this.selections.topLeft;\n          if (selection && selection.activeCell) {\n            model.activeCell = selection.activeCell;\n          }\n          if (this.sheetView.style) {\n            model.style = this.sheetView.style;\n          }\n        }\n        return false;\n      default:\n        return true;\n    }\n  }\n\n  reconcile() {}\n}\n\nmodule.exports = SheetViewXform;\n"],"mappings":"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"}