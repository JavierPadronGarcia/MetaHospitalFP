{"version":3,"file":"conditional-formattings-xform.js","names":["BaseXform","require","ConditionalFormattingXform","ConditionalFormattingsXform","cfXform","model","options","nextPriority","reduce","p","cf","Math","max","rules","map","rule","priority","forEach","style","dxfId","styles","addDxfStyle","xmlStream","render","node","parser","parseOpen","name","text","parseText","parseClose","push","undefined","getDxfStyle","module","exports"],"sources":["../../../../../../lib/xlsx/xform/sheet/cf/conditional-formattings-xform.js"],"sourcesContent":["const BaseXform = require('../../base-xform');\r\n\r\nconst ConditionalFormattingXform = require('./conditional-formatting-xform');\r\n\r\nclass ConditionalFormattingsXform extends BaseXform {\r\n  constructor() {\r\n    super();\r\n\r\n    this.cfXform = new ConditionalFormattingXform();\r\n  }\r\n\r\n  get tag() {\r\n    return 'conditionalFormatting';\r\n  }\r\n\r\n  reset() {\r\n    this.model = [];\r\n  }\r\n\r\n  prepare(model, options) {\r\n    // ensure each rule has a priority value\r\n    let nextPriority = model.reduce(\r\n      (p, cf) => Math.max(p, ...cf.rules.map(rule => rule.priority || 0)),\r\n      1\r\n    );\r\n    model.forEach(cf => {\r\n      cf.rules.forEach(rule => {\r\n        if (!rule.priority) {\r\n          rule.priority = nextPriority++;\r\n        }\r\n\r\n        if (rule.style) {\r\n          rule.dxfId = options.styles.addDxfStyle(rule.style);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    model.forEach(cf => {\r\n      this.cfXform.render(xmlStream, cf);\r\n    });\r\n  }\r\n\r\n  parseOpen(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n\r\n    switch (node.name) {\r\n      case 'conditionalFormatting':\r\n        this.parser = this.cfXform;\r\n        this.parser.parseOpen(node);\r\n        return true;\r\n\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  parseText(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  }\r\n\r\n  parseClose(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.model.push(this.parser.model);\r\n        this.parser = undefined;\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  reconcile(model, options) {\r\n    model.forEach(cf => {\r\n      cf.rules.forEach(rule => {\r\n        if (rule.dxfId !== undefined) {\r\n          rule.style = options.styles.getDxfStyle(rule.dxfId);\r\n          delete rule.dxfId;\r\n        }\r\n      });\r\n    });\r\n\r\n  }\r\n}\r\n\r\nmodule.exports = ConditionalFormattingsXform;\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,SAAS,GAAGC,OAAO,CAAC,kBAAD,CAAzB;;AAEA,IAAMC,0BAA0B,GAAGD,OAAO,CAAC,gCAAD,CAA1C;;IAEME,2B;;;;;EACJ,uCAAc;IAAA;;IAAA;;IACZ;IAEA,MAAKC,OAAL,GAAe,IAAIF,0BAAJ,EAAf;IAHY;EAIb;;;;SAED,eAAU;MACR,OAAO,uBAAP;IACD;;;WAED,iBAAQ;MACN,KAAKG,KAAL,GAAa,EAAb;IACD;;;WAED,iBAAQA,KAAR,EAAeC,OAAf,EAAwB;MACtB;MACA,IAAIC,YAAY,GAAGF,KAAK,CAACG,MAAN,CACjB,UAACC,CAAD,EAAIC,EAAJ;QAAA,OAAWC,IAAI,CAACC,GAAL,OAAAD,IAAI,GAAKF,CAAL,4BAAWC,EAAE,CAACG,KAAH,CAASC,GAAT,CAAa,UAAAC,IAAI;UAAA,OAAIA,IAAI,CAACC,QAAL,IAAiB,CAArB;QAAA,CAAjB,CAAX,GAAf;MAAA,CADiB,EAEjB,CAFiB,CAAnB;MAIAX,KAAK,CAACY,OAAN,CAAc,UAAAP,EAAE,EAAI;QAClBA,EAAE,CAACG,KAAH,CAASI,OAAT,CAAiB,UAAAF,IAAI,EAAI;UACvB,IAAI,CAACA,IAAI,CAACC,QAAV,EAAoB;YAClBD,IAAI,CAACC,QAAL,GAAgBT,YAAY,EAA5B;UACD;;UAED,IAAIQ,IAAI,CAACG,KAAT,EAAgB;YACdH,IAAI,CAACI,KAAL,GAAab,OAAO,CAACc,MAAR,CAAeC,WAAf,CAA2BN,IAAI,CAACG,KAAhC,CAAb;UACD;QACF,CARD;MASD,CAVD;IAWD;;;WAED,gBAAOI,SAAP,EAAkBjB,KAAlB,EAAyB;MAAA;;MACvBA,KAAK,CAACY,OAAN,CAAc,UAAAP,EAAE,EAAI;QAClB,MAAI,CAACN,OAAL,CAAamB,MAAb,CAAoBD,SAApB,EAA+BZ,EAA/B;MACD,CAFD;IAGD;;;WAED,mBAAUc,IAAV,EAAgB;MACd,IAAI,KAAKC,MAAT,EAAiB;QACf,KAAKA,MAAL,CAAYC,SAAZ,CAAsBF,IAAtB;QACA,OAAO,IAAP;MACD;;MAED,QAAQA,IAAI,CAACG,IAAb;QACE,KAAK,uBAAL;UACE,KAAKF,MAAL,GAAc,KAAKrB,OAAnB;UACA,KAAKqB,MAAL,CAAYC,SAAZ,CAAsBF,IAAtB;UACA,OAAO,IAAP;;QAEF;UACE,OAAO,KAAP;MAPJ;IASD;;;WAED,mBAAUI,IAAV,EAAgB;MACd,IAAI,KAAKH,MAAT,EAAiB;QACf,KAAKA,MAAL,CAAYI,SAAZ,CAAsBD,IAAtB;MACD;IACF;;;WAED,oBAAWD,IAAX,EAAiB;MACf,IAAI,KAAKF,MAAT,EAAiB;QACf,IAAI,CAAC,KAAKA,MAAL,CAAYK,UAAZ,CAAuBH,IAAvB,CAAL,EAAmC;UACjC,KAAKtB,KAAL,CAAW0B,IAAX,CAAgB,KAAKN,MAAL,CAAYpB,KAA5B;UACA,KAAKoB,MAAL,GAAcO,SAAd;UACA,OAAO,KAAP;QACD;;QACD,OAAO,IAAP;MACD;;MACD,OAAO,KAAP;IACD;;;WAED,mBAAU3B,KAAV,EAAiBC,OAAjB,EAA0B;MACxBD,KAAK,CAACY,OAAN,CAAc,UAAAP,EAAE,EAAI;QAClBA,EAAE,CAACG,KAAH,CAASI,OAAT,CAAiB,UAAAF,IAAI,EAAI;UACvB,IAAIA,IAAI,CAACI,KAAL,KAAea,SAAnB,EAA8B;YAC5BjB,IAAI,CAACG,KAAL,GAAaZ,OAAO,CAACc,MAAR,CAAea,WAAf,CAA2BlB,IAAI,CAACI,KAAhC,CAAb;YACA,OAAOJ,IAAI,CAACI,KAAZ;UACD;QACF,CALD;MAMD,CAPD;IASD;;;;EArFuCnB,S;;AAwF1CkC,MAAM,CAACC,OAAP,GAAiBhC,2BAAjB"}