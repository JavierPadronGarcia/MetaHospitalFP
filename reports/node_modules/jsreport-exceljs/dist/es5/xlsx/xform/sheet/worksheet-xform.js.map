{"version":3,"file":"worksheet-xform.js","names":["_","require","colCache","XmlStream","RelType","Merges","BaseXform","ListXform","RowXform","ColXform","DimensionXform","HyperlinkXform","MergeCellXform","DataValidationsXform","SheetPropertiesXform","SheetFormatPropertiesXform","SheetViewXform","SheetProtectionXform","PageMarginsXform","PageSetupXform","PrintOptionsXform","AutoFilterXform","PictureXform","DrawingXform","TablePartXform","RowBreaksXform","HeaderFooterXform","ConditionalFormattingsXform","ExtListXform","mergeRule","rule","extRule","Object","keys","forEach","key","value","extValue","undefined","mergeConditionalFormattings","model","extModel","length","cfMap","ruleMap","cf","ref","rules","x14Id","extCf","push","WorkSheetXform","options","maxRows","maxCols","map","sheetPr","dimension","sheetViews","tag","count","childXform","sheetFormatPr","cols","sheetData","empty","maxItems","autoFilter","mergeCells","rowBreaks","hyperlinks","pageMargins","dataValidations","pageSetup","headerFooter","printOptions","picture","drawing","sheetProtection","tableParts","conditionalFormatting","extLst","merges","comments","formulae","siFormulae","prepare","rows","conditionalFormattings","rels","nextRid","r","hyperlink","rId","Id","Type","Hyperlink","Target","target","TargetMode","comment","Comments","id","vmlDrawing","VmlDrawing","item","refAddress","decodeAddress","commentRefs","commentName","drawingRelsHash","bookImage","media","medium","type","imageId","Image","name","extension","background","image","drawingsCount","anchors","drawings","rIdImage","preImageId","anchor","range","rIdHyperLink","tooltip","tables","table","Table","columns","column","style","dxfId","styles","addDxfStyle","xmlStream","openXml","StdDocAttributes","openNode","WORKSHEET_ATTRIBUTES","sheetFormatPropertiesModel","properties","defaultRowHeight","dyDescent","outlineLevelCol","outlineLevelRow","defaultColWidth","sheetPropertiesModel","outlineProperties","tabColor","fitToPage","pageMarginsModel","margins","printOptionsModel","showRowColHeaders","showGridLines","horizontalCentered","verticalCentered","sheetProtectionModel","render","dimensions","views","rel","leafNode","closeNode","node","parser","parseOpen","each","xform","reset","text","parseText","parseClose","outlinePropertiesx","sheetProperties","assign","relationships","reduce","h","commentsMap","hyperlinkMap","address","filter","Boolean","row","cells","reconcile","drawingRel","match","drawingName","index","backgroundRel","split","mediaIndex","tablePart","xmlns","module","exports"],"sources":["../../../../../lib/xlsx/xform/sheet/worksheet-xform.js"],"sourcesContent":["const _ = require('../../../utils/under-dash');\n\nconst colCache = require('../../../utils/col-cache');\nconst XmlStream = require('../../../utils/xml-stream');\n\nconst RelType = require('../../rel-type');\n\nconst Merges = require('./merges');\n\nconst BaseXform = require('../base-xform');\nconst ListXform = require('../list-xform');\nconst RowXform = require('./row-xform');\nconst ColXform = require('./col-xform');\nconst DimensionXform = require('./dimension-xform');\nconst HyperlinkXform = require('./hyperlink-xform');\nconst MergeCellXform = require('./merge-cell-xform');\nconst DataValidationsXform = require('./data-validations-xform');\nconst SheetPropertiesXform = require('./sheet-properties-xform');\nconst SheetFormatPropertiesXform = require('./sheet-format-properties-xform');\nconst SheetViewXform = require('./sheet-view-xform');\nconst SheetProtectionXform = require('./sheet-protection-xform');\nconst PageMarginsXform = require('./page-margins-xform');\nconst PageSetupXform = require('./page-setup-xform');\nconst PrintOptionsXform = require('./print-options-xform');\nconst AutoFilterXform = require('./auto-filter-xform');\nconst PictureXform = require('./picture-xform');\nconst DrawingXform = require('./drawing-xform');\nconst TablePartXform = require('./table-part-xform');\nconst RowBreaksXform = require('./row-breaks-xform');\nconst HeaderFooterXform = require('./header-footer-xform');\nconst ConditionalFormattingsXform = require('./cf/conditional-formattings-xform');\nconst ExtListXform = require('./ext-lst-xform');\n\nconst mergeRule = (rule, extRule) => {\n  Object.keys(extRule).forEach(key => {\n    const value = rule[key];\n    const extValue = extRule[key];\n    if ((value === undefined) && (extValue !== undefined)) {\n      rule[key] = extValue;\n    }\n  });\n};\n\nconst mergeConditionalFormattings = (model, extModel) => {\n  // conditional formattings are rendered in worksheet.conditionalFormatting and also in\n  // worksheet.extLst.ext.x14:conditionalFormattings\n  // some (e.g. dataBar) are even spread across both!\n  if (!extModel || !extModel.length) {\n    return model;\n  }\n  if (!model || !model.length) {\n    return extModel;\n  }\n\n  // index model rules by x14Id\n  const cfMap = {};\n  const ruleMap = {};\n  model.forEach(cf => {\n    cfMap[cf.ref] = cf;\n    cf.rules.forEach(rule => {\n      const {x14Id} = rule;\n      if (x14Id) {\n        ruleMap[x14Id] = rule;\n      }\n    });\n  });\n\n  extModel.forEach(extCf => {\n    extCf.rules.forEach(extRule => {\n      const rule = ruleMap[extRule.x14Id];\n      if (rule) {\n        // merge with matching rule\n        mergeRule(rule, extRule);\n      } else if (cfMap[extCf.ref]) {\n        // reuse existing cf ref\n        cfMap[extCf.ref].rules.push(extRule);\n      } else {\n        // create new cf\n        model.push({\n          ref: extCf.ref,\n          rules: [extRule],\n        });\n      }\n    });\n  });\n\n  // need to cope with rules in extModel that don't exist in model\n  return model;\n};\n\nclass WorkSheetXform extends BaseXform {\n  constructor(options) {\n    super();\n\n    const {maxRows, maxCols} = options || {};\n    this.map = {\n      sheetPr: new SheetPropertiesXform(),\n      dimension: new DimensionXform(),\n      sheetViews: new ListXform({tag: 'sheetViews', count: false, childXform: new SheetViewXform()}),\n      sheetFormatPr: new SheetFormatPropertiesXform(),\n      cols: new ListXform({tag: 'cols', count: false, childXform: new ColXform()}),\n      sheetData: new ListXform({\n        tag: 'sheetData',\n        count: false,\n        empty: true,\n        childXform: new RowXform({maxItems: maxCols}),\n        maxItems: maxRows,\n      }),\n      autoFilter: new AutoFilterXform(),\n      mergeCells: new ListXform({tag: 'mergeCells', count: true, childXform: new MergeCellXform()}),\n      rowBreaks: new RowBreaksXform(),\n      hyperlinks: new ListXform({tag: 'hyperlinks', count: false, childXform: new HyperlinkXform()}),\n      pageMargins: new PageMarginsXform(),\n      dataValidations: new DataValidationsXform(),\n      pageSetup: new PageSetupXform(),\n      headerFooter: new HeaderFooterXform(),\n      printOptions: new PrintOptionsXform(),\n      picture: new PictureXform(),\n      drawing: new DrawingXform(),\n      sheetProtection: new SheetProtectionXform(),\n      tableParts: new ListXform({tag: 'tableParts', count: true, childXform: new TablePartXform()}),\n      conditionalFormatting: new ConditionalFormattingsXform(),\n      extLst: new ExtListXform(),\n    };\n  }\n\n  prepare(model, options) {\n    options.merges = new Merges();\n    model.hyperlinks = options.hyperlinks = [];\n    model.comments = options.comments = [];\n\n    options.formulae = {};\n    options.siFormulae = 0;\n    this.map.cols.prepare(model.cols, options);\n    this.map.sheetData.prepare(model.rows, options);\n    this.map.conditionalFormatting.prepare(model.conditionalFormattings, options);\n\n    model.mergeCells = options.merges.mergeCells;\n\n    // prepare relationships\n    const rels = (model.rels = []);\n\n    function nextRid(r) {\n      return `rId${r.length + 1}`;\n    }\n\n    model.hyperlinks.forEach(hyperlink => {\n      const rId = nextRid(rels);\n      hyperlink.rId = rId;\n      rels.push({\n        Id: rId,\n        Type: RelType.Hyperlink,\n        Target: hyperlink.target,\n        TargetMode: 'External',\n      });\n    });\n\n    // prepare comment relationships\n    if (model.comments.length > 0) {\n      const comment = {\n        Id: nextRid(rels),\n        Type: RelType.Comments,\n        Target: `../comments${model.id}.xml`,\n      };\n      rels.push(comment);\n      const vmlDrawing = {\n        Id: nextRid(rels),\n        Type: RelType.VmlDrawing,\n        Target: `../drawings/vmlDrawing${model.id}.vml`,\n      };\n      rels.push(vmlDrawing);\n\n      model.comments.forEach(item => {\n        item.refAddress = colCache.decodeAddress(item.ref);\n      });\n\n      options.commentRefs.push({\n        commentName: `comments${model.id}`,\n        vmlDrawing: `vmlDrawing${model.id}`,\n      });\n    }\n\n    const drawingRelsHash = [];\n    let bookImage;\n    model.media.forEach(medium => {\n      if (medium.type === 'background') {\n        const rId = nextRid(rels);\n        bookImage = options.media[medium.imageId];\n        rels.push({\n          Id: rId,\n          Type: RelType.Image,\n          Target: `../media/${bookImage.name}.${bookImage.extension}`,\n        });\n        model.background = {\n          rId,\n        };\n        model.image = options.media[medium.imageId];\n      } else if (medium.type === 'image') {\n        let {drawing} = model;\n        bookImage = options.media[medium.imageId];\n        if (!drawing) {\n          drawing = model.drawing = {\n            rId: nextRid(rels),\n            name: `drawing${++options.drawingsCount}`,\n            anchors: [],\n            rels: [],\n          };\n          options.drawings.push(drawing);\n          rels.push({\n            Id: drawing.rId,\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing',\n            Target: `../drawings/${drawing.name}.xml`,\n          });\n        }\n        let rIdImage = this.preImageId === medium.imageId ? drawingRelsHash[medium.imageId]: drawingRelsHash[drawing.rels.length];\n        if (!rIdImage) {\n          rIdImage = nextRid(drawing.rels);\n          drawingRelsHash[drawing.rels.length] = rIdImage;\n          drawing.rels.push({\n            Id: rIdImage,\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image',\n            Target: `../media/${bookImage.name}.${bookImage.extension}`,\n          });\n        }\n\n        const anchor = {\n          picture: {\n            rId: rIdImage,\n          },\n          range: medium.range,\n        };\n        let rIdHyperLink = drawingRelsHash[drawing.rels.length];\n        if (medium.hyperlinks && medium.hyperlinks.hyperlink) {\n          rIdHyperLink = nextRid(drawing.rels);\n          drawingRelsHash[drawing.rels.length] = rIdHyperLink;\n          anchor.picture.hyperlinks = {\n            tooltip: medium.hyperlinks.tooltip,\n            rId: rIdHyperLink,\n          };\n          drawing.rels.push({\n            Id: rIdHyperLink,\n            Type: RelType.Hyperlink,\n            Target: medium.hyperlinks.hyperlink,\n            TargetMode: 'External',\n          });\n        }\n        this.preImageId = medium.imageId;\n        drawing.anchors.push(anchor);\n      }\n    });\n\n    // prepare tables\n    model.tables.forEach(table => {\n      // relationships\n      const rId = nextRid(rels);\n      table.rId = rId;\n      rels.push({\n        Id: rId,\n        Type: RelType.Table,\n        Target: `../tables/${table.target}`,\n      });\n\n      // dynamic styles\n      table.columns.forEach(column => {\n        const {style} = column;\n        if (style) {\n          column.dxfId = options.styles.addDxfStyle(style);\n        }\n      });\n    });\n\n    // prepare ext items\n    this.map.extLst.prepare(model, options);\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n    xmlStream.openNode('worksheet', WorkSheetXform.WORKSHEET_ATTRIBUTES);\n\n    const sheetFormatPropertiesModel = model.properties\n      ? {\n        defaultRowHeight: model.properties.defaultRowHeight,\n        dyDescent: model.properties.dyDescent,\n        outlineLevelCol: model.properties.outlineLevelCol,\n        outlineLevelRow: model.properties.outlineLevelRow,\n      }\n      : undefined;\n    if (model.properties && model.properties.defaultColWidth) {\n      sheetFormatPropertiesModel.defaultColWidth = model.properties.defaultColWidth;\n    }\n    const sheetPropertiesModel = {\n      outlineProperties: model.properties && model.properties.outlineProperties,\n      tabColor: model.properties && model.properties.tabColor,\n      pageSetup:\n        model.pageSetup && model.pageSetup.fitToPage\n          ? {\n            fitToPage: model.pageSetup.fitToPage,\n          }\n          : undefined,\n    };\n    const pageMarginsModel = model.pageSetup && model.pageSetup.margins;\n    const printOptionsModel = {\n      showRowColHeaders: model.pageSetup && model.pageSetup.showRowColHeaders,\n      showGridLines: model.pageSetup && model.pageSetup.showGridLines,\n      horizontalCentered: model.pageSetup && model.pageSetup.horizontalCentered,\n      verticalCentered: model.pageSetup && model.pageSetup.verticalCentered,\n    };\n    const sheetProtectionModel = model.sheetProtection;\n\n    this.map.sheetPr.render(xmlStream, sheetPropertiesModel);\n    this.map.dimension.render(xmlStream, model.dimensions);\n    this.map.sheetViews.render(xmlStream, model.views);\n    this.map.sheetFormatPr.render(xmlStream, sheetFormatPropertiesModel);\n    this.map.cols.render(xmlStream, model.cols);\n    this.map.sheetData.render(xmlStream, model.rows);\n    this.map.sheetProtection.render(xmlStream, sheetProtectionModel); // Note: must be after sheetData and before autoFilter\n    this.map.autoFilter.render(xmlStream, model.autoFilter);\n    this.map.mergeCells.render(xmlStream, model.mergeCells);\n    this.map.dataValidations.render(xmlStream, model.dataValidations);\n\n    // For some reason hyperlinks have to be after the data validations\n    this.map.hyperlinks.render(xmlStream, model.hyperlinks);\n\n    this.map.conditionalFormatting.render(xmlStream, model.conditionalFormattings);\n    this.map.printOptions.render(xmlStream, printOptionsModel); // Note: must be before pageMargins\n    this.map.pageMargins.render(xmlStream, pageMarginsModel);\n    this.map.pageSetup.render(xmlStream, model.pageSetup);\n    this.map.headerFooter.render(xmlStream, model.headerFooter);\n    this.map.rowBreaks.render(xmlStream, model.rowBreaks);\n    this.map.drawing.render(xmlStream, model.drawing); // Note: must be after rowBreaks\n    this.map.picture.render(xmlStream, model.background); // Note: must be after drawing\n    this.map.tableParts.render(xmlStream, model.tables);\n\n    this.map.extLst.render(xmlStream, model);\n\n    if (model.rels) {\n      // add a <legacyDrawing /> node for each comment\n      model.rels.forEach(rel => {\n        if (rel.Type === RelType.VmlDrawing) {\n          xmlStream.leafNode('legacyDrawing', {'r:id': rel.Id});\n        }\n      });\n    }\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n\n    if (node.name === 'worksheet') {\n      _.each(this.map, xform => {\n        xform.reset();\n      });\n      return true;\n    }\n\n    this.parser = this.map[node.name];\n    if (this.parser) {\n      this.parser.parseOpen(node);\n    }\n    return true;\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case 'worksheet': {\n        const properties = this.map.sheetFormatPr.model;\n        if (this.map.sheetPr.model && this.map.sheetPr.model.tabColor) {\n          properties.tabColor = this.map.sheetPr.model.tabColor;\n        }\n        if (this.map.sheetPr.model && this.map.sheetPr.model.outlineProperties) {\n          properties.outlineProperties = this.map.sheetPr.model.outlinePropertiesx;\n        }\n        const sheetProperties = {\n          fitToPage: (this.map.sheetPr.model && this.map.sheetPr.model.pageSetup && this.map.sheetPr.model.pageSetup.fitToPage) || false,\n          margins: this.map.pageMargins.model,\n        };\n        const pageSetup = Object.assign(sheetProperties, this.map.pageSetup.model, this.map.printOptions.model);\n        const conditionalFormattings = mergeConditionalFormattings(\n          this.map.conditionalFormatting.model,\n          this.map.extLst.model && this.map.extLst.model['x14:conditionalFormattings']\n        );\n        this.model = {\n          dimensions: this.map.dimension.model,\n          cols: this.map.cols.model,\n          rows: this.map.sheetData.model,\n          mergeCells: this.map.mergeCells.model,\n          hyperlinks: this.map.hyperlinks.model,\n          dataValidations: this.map.dataValidations.model,\n          properties,\n          views: this.map.sheetViews.model,\n          pageSetup,\n          headerFooter: this.map.headerFooter.model,\n          background: this.map.picture.model,\n          drawing: this.map.drawing.model,\n          tables: this.map.tableParts.model,\n          conditionalFormattings,\n        };\n\n        if (this.map.autoFilter.model) {\n          this.model.autoFilter = this.map.autoFilter.model;\n        }\n        if (this.map.sheetProtection.model) {\n          this.model.sheetProtection = this.map.sheetProtection.model;\n        }\n\n        return false;\n      }\n\n      default:\n        // not quite sure how we get here!\n        return true;\n    }\n  }\n\n  reconcile(model, options) {\n    // options.merges = new Merges();\n    // options.merges.reconcile(model.mergeCells, model.rows);\n    const rels = (model.relationships || []).reduce((h, rel) => {\n      h[rel.Id] = rel;\n      if (rel.Type === RelType.Comments) {\n        model.comments = options.comments[rel.Target].comments;\n      }\n      return h;\n    }, {});\n    options.commentsMap = (model.comments || []).reduce((h, comment) => {\n      if (comment.ref) {\n        h[comment.ref] = comment;\n      }\n      return h;\n    }, {});\n    options.hyperlinkMap = (model.hyperlinks || []).reduce((h, hyperlink) => {\n      if (hyperlink.rId) {\n        h[hyperlink.address] = rels[hyperlink.rId].Target;\n      }\n      return h;\n    }, {});\n    options.formulae = {};\n\n    // compact the rows and cells\n    model.rows = (model.rows && model.rows.filter(Boolean)) || [];\n    model.rows.forEach(row => {\n      row.cells = (row.cells && row.cells.filter(Boolean)) || [];\n    });\n\n    this.map.cols.reconcile(model.cols, options);\n    this.map.sheetData.reconcile(model.rows, options);\n    this.map.conditionalFormatting.reconcile(model.conditionalFormattings, options);\n\n    model.media = [];\n    if (model.drawing) {\n      const drawingRel = rels[model.drawing.rId];\n      const match = drawingRel.Target.match(/\\/drawings\\/([a-zA-Z0-9]+)[.][a-zA-Z]{3,4}$/);\n      if (match) {\n        const drawingName = match[1];\n        const drawing = options.drawings[drawingName];\n        drawing.anchors.forEach(anchor => {\n          if (anchor.medium) {\n            const image = {\n              type: 'image',\n              imageId: anchor.medium.index,\n              range: anchor.range,\n              hyperlinks: anchor.picture.hyperlinks,\n            };\n            model.media.push(image);\n          }\n        });\n      }\n    }\n    \n    const backgroundRel = model.background && rels[model.background.rId];\n    if (backgroundRel) {\n      const target = backgroundRel.Target.split('/media/')[1];\n      const imageId = options.mediaIndex && options.mediaIndex[target];\n      if (imageId !== undefined) {\n        model.media.push({\n          type: 'background',\n          imageId,\n        });\n      }\n    }\n\n    model.tables = (model.tables || []).map(tablePart => {\n      const rel = rels[tablePart.rId];\n      return options.tables[rel.Target];\n    });\n\n    delete model.relationships;\n    delete model.hyperlinks;\n    delete model.comments;\n  }\n}\n\nWorkSheetXform.WORKSHEET_ATTRIBUTES = {\n  xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\n  'xmlns:r': 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\n  'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\n  'mc:Ignorable': 'x14ac',\n  'xmlns:x14ac': 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac',\n};\n\nmodule.exports = WorkSheetXform;\n"],"mappings":"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"}