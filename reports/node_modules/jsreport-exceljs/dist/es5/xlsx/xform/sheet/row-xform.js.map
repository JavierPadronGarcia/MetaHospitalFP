{"version":3,"file":"row-xform.js","names":["BaseXform","require","CellXform","RowXform","options","maxItems","map","c","model","styleId","styles","addStyleModel","style","cellXform","cells","forEach","cellModel","prepare","xmlStream","openNode","addAttribute","number","height","hidden","min","max","outlineLevel","collapsed","render","closeNode","node","parser","parseOpen","name","numRowsSeen","spans","attributes","split","span","parseInt","undefined","r","s","bestFit","ht","parseFloat","text","parseText","parseClose","push","length","Error","getStyleModel","reconcile","module","exports"],"sources":["../../../../../lib/xlsx/xform/sheet/row-xform.js"],"sourcesContent":["const BaseXform = require('../base-xform');\n\nconst CellXform = require('./cell-xform');\n\nclass RowXform extends BaseXform {\n  constructor(options) {\n    super();\n\n    this.maxItems = options && options.maxItems;\n    this.map = {\n      c: new CellXform(),\n    };\n  }\n\n  get tag() {\n    return 'row';\n  }\n\n  prepare(model, options) {\n    const styleId = options.styles.addStyleModel(model.style);\n    if (styleId) {\n      model.styleId = styleId;\n    }\n    const cellXform = this.map.c;\n    model.cells.forEach(cellModel => {\n      cellXform.prepare(cellModel, options);\n    });\n  }\n\n  render(xmlStream, model, options) {\n    xmlStream.openNode('row');\n    xmlStream.addAttribute('r', model.number);\n    if (model.height) {\n      xmlStream.addAttribute('ht', model.height);\n      xmlStream.addAttribute('customHeight', '1');\n    }\n    if (model.hidden) {\n      xmlStream.addAttribute('hidden', '1');\n    }\n    if (model.min > 0 && model.max > 0 && model.min <= model.max) {\n      xmlStream.addAttribute('spans', `${model.min}:${model.max}`);\n    }\n    if (model.styleId) {\n      xmlStream.addAttribute('s', model.styleId);\n      xmlStream.addAttribute('customFormat', '1');\n    }\n    xmlStream.addAttribute('x14ac:dyDescent', '0.25');\n    if (model.outlineLevel) {\n      xmlStream.addAttribute('outlineLevel', model.outlineLevel);\n    }\n    if (model.collapsed) {\n      xmlStream.addAttribute('collapsed', '1');\n    }\n\n    const cellXform = this.map.c;\n    model.cells.forEach(cellModel => {\n      cellXform.render(xmlStream, cellModel, options);\n    });\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    if (node.name === 'row') {\n      this.numRowsSeen += 1;\n      const spans = node.attributes.spans ? node.attributes.spans.split(':').map(span => parseInt(span, 10)) : [undefined, undefined];\n      const model = (this.model = {\n        number: parseInt(node.attributes.r, 10),\n        min: spans[0],\n        max: spans[1],\n        cells: [],\n      });\n      if (node.attributes.s) {\n        model.styleId = parseInt(node.attributes.s, 10);\n      }\n      if (node.attributes.hidden) {\n        model.hidden = true;\n      }\n      if (node.attributes.bestFit) {\n        model.bestFit = true;\n      }\n      if (node.attributes.ht) {\n        model.height = parseFloat(node.attributes.ht);\n      }\n      if (node.attributes.outlineLevel) {\n        model.outlineLevel = parseInt(node.attributes.outlineLevel, 10);\n      }\n      if (node.attributes.collapsed) {\n        model.collapsed = true;\n      }\n      return true;\n    }\n\n    this.parser = this.map[node.name];\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    return false;\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.model.cells.push(this.parser.model);\n        if (this.maxItems && this.model.cells.length > this.maxItems) {\n          throw new Error('Max column count exceeded');\n        }\n        this.parser = undefined;\n      }\n      return true;\n    }\n    return false;\n  }\n\n  reconcile(model, options) {\n    model.style = model.styleId ? options.styles.getStyleModel(model.styleId) : {};\n    if (model.styleId !== undefined) {\n      model.styleId = undefined;\n    }\n\n    const cellXform = this.map.c;\n    model.cells.forEach(cellModel => {\n      cellXform.reconcile(cellModel, options);\n    });\n  }\n}\n\nmodule.exports = RowXform;\n"],"mappings":"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"}