{"version":3,"file":"content-types-xform.js","names":["XmlStream","require","BaseXform","ContentTypesXform","xmlStream","model","openXml","StdDocAttributes","openNode","PROPERTY_ATTRIBUTES","mediaHash","media","forEach","medium","type","imageType","extension","leafNode","Extension","ContentType","PartName","worksheets","worksheet","name","id","hasSharedStrings","sharedStrings","count","tables","table","target","drawings","drawing","commentRefs","commentName","closeNode","xmlns","module","exports"],"sources":["../../../../../lib/xlsx/xform/core/content-types-xform.js"],"sourcesContent":["const XmlStream = require('../../../utils/xml-stream');\n\nconst BaseXform = require('../base-xform');\n\n// used for rendering the [Content_Types].xml file\n// not used for parsing\nclass ContentTypesXform extends BaseXform {\n  render(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n\n    xmlStream.openNode('Types', ContentTypesXform.PROPERTY_ATTRIBUTES);\n\n    const mediaHash = {};\n    (model.media || []).forEach(medium => {\n      if (medium.type === 'image') {\n        const imageType = medium.extension;\n        if (!mediaHash[imageType]) {\n          mediaHash[imageType] = true;\n          xmlStream.leafNode('Default', {Extension: imageType, ContentType: `image/${imageType}`});\n        }\n      }\n    });\n\n    xmlStream.leafNode('Default', {Extension: 'rels', ContentType: 'application/vnd.openxmlformats-package.relationships+xml'});\n    xmlStream.leafNode('Default', {Extension: 'xml', ContentType: 'application/xml'});\n\n    xmlStream.leafNode('Override', {\n      PartName: '/xl/workbook.xml',\n      ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml',\n    });\n\n    model.worksheets.forEach(worksheet => {\n      const name = `/xl/worksheets/sheet${worksheet.id}.xml`;\n      xmlStream.leafNode('Override', {PartName: name, ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml'});\n    });\n\n    xmlStream.leafNode('Override', {PartName: '/xl/theme/theme1.xml', ContentType: 'application/vnd.openxmlformats-officedocument.theme+xml'});\n    xmlStream.leafNode('Override', {PartName: '/xl/styles.xml', ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml'});\n\n    const hasSharedStrings = model.sharedStrings && model.sharedStrings.count;\n    if (hasSharedStrings) {\n      xmlStream.leafNode('Override', {\n        PartName: '/xl/sharedStrings.xml',\n        ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml',\n      });\n    }\n\n    if (model.tables) {\n      model.tables.forEach(table => {\n        xmlStream.leafNode('Override', {\n          PartName: `/xl/tables/${table.target}`,\n          ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml',\n        });\n      });\n    }\n\n    if (model.drawings) {\n      model.drawings.forEach(drawing => {\n        xmlStream.leafNode('Override', {\n          PartName: `/xl/drawings/${drawing.name}.xml`,\n          ContentType: 'application/vnd.openxmlformats-officedocument.drawing+xml',\n        });\n      });\n    }\n\n    if (model.commentRefs) {\n      xmlStream.leafNode('Default', {\n        Extension: 'vml',\n        ContentType: 'application/vnd.openxmlformats-officedocument.vmlDrawing',\n      });\n\n      model.commentRefs.forEach(({commentName}) => {\n        xmlStream.leafNode('Override', {\n          PartName: `/xl/${commentName}.xml`,\n          ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml',\n        });\n      });\n    }\n\n    xmlStream.leafNode('Override', {PartName: '/docProps/core.xml', ContentType: 'application/vnd.openxmlformats-package.core-properties+xml'});\n    xmlStream.leafNode('Override', {PartName: '/docProps/app.xml', ContentType: 'application/vnd.openxmlformats-officedocument.extended-properties+xml'});\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen() {\n    return false;\n  }\n\n  parseText() {\n\n  }\n\n  parseClose() {\n    return false;\n  }\n}\n\nContentTypesXform.PROPERTY_ATTRIBUTES = {\n  xmlns: 'http://schemas.openxmlformats.org/package/2006/content-types',\n};\n\nmodule.exports = ContentTypesXform;\n"],"mappings":"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"}