{"version":3,"file":"core-xform.js","names":["XmlStream","require","BaseXform","DateXform","StringXform","IntegerXform","CoreXform","map","tag","format","DateFormat","attrs","DateAttrs","xmlStream","model","openXml","StdDocAttributes","openNode","CORE_PROPERTY_ATTRIBUTES","render","creator","title","subject","description","identifier","language","keywords","category","lastModifiedBy","lastPrinted","revision","version","contentStatus","contentType","created","modified","closeNode","node","parser","parseOpen","name","Error","JSON","stringify","text","parseText","parseClose","undefined","dt","toISOString","replace","module","exports"],"sources":["../../../../../lib/xlsx/xform/core/core-xform.js"],"sourcesContent":["const XmlStream = require('../../../utils/xml-stream');\nconst BaseXform = require('../base-xform');\nconst DateXform = require('../simple/date-xform');\nconst StringXform = require('../simple/string-xform');\nconst IntegerXform = require('../simple/integer-xform');\n\nclass CoreXform extends BaseXform {\n  constructor() {\n    super();\n\n    this.map = {\n      'dc:creator': new StringXform({tag: 'dc:creator'}),\n      'dc:title': new StringXform({tag: 'dc:title'}),\n      'dc:subject': new StringXform({tag: 'dc:subject'}),\n      'dc:description': new StringXform({tag: 'dc:description'}),\n      'dc:identifier': new StringXform({tag: 'dc:identifier'}),\n      'dc:language': new StringXform({tag: 'dc:language'}),\n      'cp:keywords': new StringXform({tag: 'cp:keywords'}),\n      'cp:category': new StringXform({tag: 'cp:category'}),\n      'cp:lastModifiedBy': new StringXform({tag: 'cp:lastModifiedBy'}),\n      'cp:lastPrinted': new DateXform({tag: 'cp:lastPrinted', format: CoreXform.DateFormat}),\n      'cp:revision': new IntegerXform({tag: 'cp:revision'}),\n      'cp:version': new StringXform({tag: 'cp:version'}),\n      'cp:contentStatus': new StringXform({tag: 'cp:contentStatus'}),\n      'cp:contentType': new StringXform({tag: 'cp:contentType'}),\n      'dcterms:created': new DateXform({tag: 'dcterms:created', attrs: CoreXform.DateAttrs, format: CoreXform.DateFormat}),\n      'dcterms:modified': new DateXform({tag: 'dcterms:modified', attrs: CoreXform.DateAttrs, format: CoreXform.DateFormat}),\n    };\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n\n    xmlStream.openNode('cp:coreProperties', CoreXform.CORE_PROPERTY_ATTRIBUTES);\n\n    this.map['dc:creator'].render(xmlStream, model.creator);\n    this.map['dc:title'].render(xmlStream, model.title);\n    this.map['dc:subject'].render(xmlStream, model.subject);\n    this.map['dc:description'].render(xmlStream, model.description);\n    this.map['dc:identifier'].render(xmlStream, model.identifier);\n    this.map['dc:language'].render(xmlStream, model.language);\n    this.map['cp:keywords'].render(xmlStream, model.keywords);\n    this.map['cp:category'].render(xmlStream, model.category);\n    this.map['cp:lastModifiedBy'].render(xmlStream, model.lastModifiedBy);\n    this.map['cp:lastPrinted'].render(xmlStream, model.lastPrinted);\n    this.map['cp:revision'].render(xmlStream, model.revision);\n    this.map['cp:version'].render(xmlStream, model.version);\n    this.map['cp:contentStatus'].render(xmlStream, model.contentStatus);\n    this.map['cp:contentType'].render(xmlStream, model.contentType);\n    this.map['dcterms:created'].render(xmlStream, model.created);\n    this.map['dcterms:modified'].render(xmlStream, model.modified);\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    switch (node.name) {\n      case 'cp:coreProperties':\n      case 'coreProperties':\n        return true;\n      default:\n        this.parser = this.map[node.name];\n        if (this.parser) {\n          this.parser.parseOpen(node);\n          return true;\n        }\n        throw new Error(`Unexpected xml node in parseOpen: ${JSON.stringify(node)}`);\n    }\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case 'cp:coreProperties':\n      case 'coreProperties':\n        this.model = {\n          creator: this.map['dc:creator'].model,\n          title: this.map['dc:title'].model,\n          subject: this.map['dc:subject'].model,\n          description: this.map['dc:description'].model,\n          identifier: this.map['dc:identifier'].model,\n          language: this.map['dc:language'].model,\n          keywords: this.map['cp:keywords'].model,\n          category: this.map['cp:category'].model,\n          lastModifiedBy: this.map['cp:lastModifiedBy'].model,\n          lastPrinted: this.map['cp:lastPrinted'].model,\n          revision: this.map['cp:revision'].model,\n          contentStatus: this.map['cp:contentStatus'].model,\n          contentType: this.map['cp:contentType'].model,\n          created: this.map['dcterms:created'].model,\n          modified: this.map['dcterms:modified'].model,\n        };\n        return false;\n      default:\n        throw new Error(`Unexpected xml node in parseClose: ${name}`);\n    }\n  }\n}\n\nCoreXform.DateFormat = function(dt) {\n  return dt.toISOString().replace(/[.]\\d{3}/, '');\n};\nCoreXform.DateAttrs = {'xsi:type': 'dcterms:W3CDTF'};\n\nCoreXform.CORE_PROPERTY_ATTRIBUTES = {\n  'xmlns:cp': 'http://schemas.openxmlformats.org/package/2006/metadata/core-properties',\n  'xmlns:dc': 'http://purl.org/dc/elements/1.1/',\n  'xmlns:dcterms': 'http://purl.org/dc/terms/',\n  'xmlns:dcmitype': 'http://purl.org/dc/dcmitype/',\n  'xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance',\n};\n\n\nmodule.exports = CoreXform;\n"],"mappings":"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"}