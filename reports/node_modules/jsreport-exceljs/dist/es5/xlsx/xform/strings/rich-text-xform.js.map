{"version":3,"file":"rich-text-xform.js","names":["TextXform","require","FontXform","BaseXform","RichTextXform","model","_textXform","_fontXform","FONT_OPTIONS","xmlStream","openNode","font","fontXform","render","textXform","text","closeNode","node","parser","parseOpen","name","parseText","undefined","parseClose","tagName","fontNameTag","module","exports"],"sources":["../../../../../lib/xlsx/xform/strings/rich-text-xform.js"],"sourcesContent":["const TextXform = require('./text-xform');\nconst FontXform = require('../style/font-xform');\n\nconst BaseXform = require('../base-xform');\n\n// <r>\n//   <rPr>\n//     <sz val=\"11\"/>\n//     <color theme=\"1\" tint=\"5\"/>\n//     <rFont val=\"Calibri\"/>\n//     <family val=\"2\"/>\n//     <scheme val=\"minor\"/>\n//   </rPr>\n//   <t xml:space=\"preserve\"> is </t>\n// </r>\n\nclass RichTextXform extends BaseXform {\n  constructor(model) {\n    super();\n\n    this.model = model;\n  }\n\n  get tag() {\n    return 'r';\n  }\n\n  get textXform() {\n    return this._textXform || (this._textXform = new TextXform());\n  }\n\n  get fontXform() {\n    return this._fontXform || (this._fontXform = new FontXform(RichTextXform.FONT_OPTIONS));\n  }\n\n  render(xmlStream, model) {\n    model = model || this.model;\n\n    xmlStream.openNode('r');\n    if (model.font) {\n      this.fontXform.render(xmlStream, model.font);\n    }\n    this.textXform.render(xmlStream, model.text);\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    switch (node.name) {\n      case 'r':\n        this.model = {};\n        return true;\n      case 't':\n        this.parser = this.textXform;\n        this.parser.parseOpen(node);\n        return true;\n      case 'rPr':\n        this.parser = this.fontXform;\n        this.parser.parseOpen(node);\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    switch (name) {\n      case 'r':\n        return false;\n      case 't':\n        this.model.text = this.parser.model;\n        this.parser = undefined;\n        return true;\n      case 'rPr':\n        this.model.font = this.parser.model;\n        this.parser = undefined;\n        return true;\n      default:\n        if (this.parser) {\n          this.parser.parseClose(name);\n        }\n        return true;\n    }\n  }\n}\n\nRichTextXform.FONT_OPTIONS = {\n  tagName: 'rPr',\n  fontNameTag: 'rFont',\n};\n\nmodule.exports = RichTextXform;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,SAAS,GAAGC,OAAO,CAAC,cAAD,CAAzB;;AACA,IAAMC,SAAS,GAAGD,OAAO,CAAC,qBAAD,CAAzB;;AAEA,IAAME,SAAS,GAAGF,OAAO,CAAC,eAAD,CAAzB,C,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;IAEMG,a;;;;;EACJ,uBAAYC,KAAZ,EAAmB;IAAA;;IAAA;;IACjB;IAEA,MAAKA,KAAL,GAAaA,KAAb;IAHiB;EAIlB;;;;SAED,eAAU;MACR,OAAO,GAAP;IACD;;;SAED,eAAgB;MACd,OAAO,KAAKC,UAAL,KAAoB,KAAKA,UAAL,GAAkB,IAAIN,SAAJ,EAAtC,CAAP;IACD;;;SAED,eAAgB;MACd,OAAO,KAAKO,UAAL,KAAoB,KAAKA,UAAL,GAAkB,IAAIL,SAAJ,CAAcE,aAAa,CAACI,YAA5B,CAAtC,CAAP;IACD;;;WAED,gBAAOC,SAAP,EAAkBJ,KAAlB,EAAyB;MACvBA,KAAK,GAAGA,KAAK,IAAI,KAAKA,KAAtB;MAEAI,SAAS,CAACC,QAAV,CAAmB,GAAnB;;MACA,IAAIL,KAAK,CAACM,IAAV,EAAgB;QACd,KAAKC,SAAL,CAAeC,MAAf,CAAsBJ,SAAtB,EAAiCJ,KAAK,CAACM,IAAvC;MACD;;MACD,KAAKG,SAAL,CAAeD,MAAf,CAAsBJ,SAAtB,EAAiCJ,KAAK,CAACU,IAAvC;MACAN,SAAS,CAACO,SAAV;IACD;;;WAED,mBAAUC,IAAV,EAAgB;MACd,IAAI,KAAKC,MAAT,EAAiB;QACf,KAAKA,MAAL,CAAYC,SAAZ,CAAsBF,IAAtB;QACA,OAAO,IAAP;MACD;;MACD,QAAQA,IAAI,CAACG,IAAb;QACE,KAAK,GAAL;UACE,KAAKf,KAAL,GAAa,EAAb;UACA,OAAO,IAAP;;QACF,KAAK,GAAL;UACE,KAAKa,MAAL,GAAc,KAAKJ,SAAnB;UACA,KAAKI,MAAL,CAAYC,SAAZ,CAAsBF,IAAtB;UACA,OAAO,IAAP;;QACF,KAAK,KAAL;UACE,KAAKC,MAAL,GAAc,KAAKN,SAAnB;UACA,KAAKM,MAAL,CAAYC,SAAZ,CAAsBF,IAAtB;UACA,OAAO,IAAP;;QACF;UACE,OAAO,KAAP;MAbJ;IAeD;;;WAED,mBAAUF,IAAV,EAAgB;MACd,IAAI,KAAKG,MAAT,EAAiB;QACf,KAAKA,MAAL,CAAYG,SAAZ,CAAsBN,IAAtB;MACD;IACF;;;WAED,oBAAWK,IAAX,EAAiB;MACf,QAAQA,IAAR;QACE,KAAK,GAAL;UACE,OAAO,KAAP;;QACF,KAAK,GAAL;UACE,KAAKf,KAAL,CAAWU,IAAX,GAAkB,KAAKG,MAAL,CAAYb,KAA9B;UACA,KAAKa,MAAL,GAAcI,SAAd;UACA,OAAO,IAAP;;QACF,KAAK,KAAL;UACE,KAAKjB,KAAL,CAAWM,IAAX,GAAkB,KAAKO,MAAL,CAAYb,KAA9B;UACA,KAAKa,MAAL,GAAcI,SAAd;UACA,OAAO,IAAP;;QACF;UACE,IAAI,KAAKJ,MAAT,EAAiB;YACf,KAAKA,MAAL,CAAYK,UAAZ,CAAuBH,IAAvB;UACD;;UACD,OAAO,IAAP;MAfJ;IAiBD;;;;EA5EyBjB,S;;AA+E5BC,aAAa,CAACI,YAAd,GAA6B;EAC3BgB,OAAO,EAAE,KADkB;EAE3BC,WAAW,EAAE;AAFc,CAA7B;AAKAC,MAAM,CAACC,OAAP,GAAiBvB,aAAjB"}