{"version":3,"file":"comments-xform.js","names":["XmlStream","require","utils","BaseXform","CommentXform","CommentsXform","module","exports","map","comment","inherits","COMMENTS_ATTRIBUTES","xmlns","render","xmlStream","model","openXml","StdDocAttributes","openNode","leafNode","closeNode","comments","forEach","parseOpen","node","parser","name","parseText","text","parseClose","push","undefined"],"sources":["../../../../../lib/xlsx/xform/comment/comments-xform.js"],"sourcesContent":["const XmlStream = require('../../../utils/xml-stream');\nconst utils = require('../../../utils/utils');\nconst BaseXform = require('../base-xform');\n\nconst CommentXform = require('./comment-xform');\n\nconst CommentsXform = (module.exports = function() {\n  this.map = {\n    comment: new CommentXform(),\n  };\n});\n\nutils.inherits(\n  CommentsXform,\n  BaseXform,\n  {\n    COMMENTS_ATTRIBUTES: {\n      xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\n    },\n  },\n  {\n    render(xmlStream, model) {\n      model = model || this.model;\n      xmlStream.openXml(XmlStream.StdDocAttributes);\n      xmlStream.openNode('comments', CommentsXform.COMMENTS_ATTRIBUTES);\n\n      // authors\n      // TODO: support authors properly\n      xmlStream.openNode('authors');\n      xmlStream.leafNode('author', null, 'Author');\n      xmlStream.closeNode();\n\n      // comments\n      xmlStream.openNode('commentList');\n      model.comments.forEach(comment => {\n        this.map.comment.render(xmlStream, comment);\n      });\n      xmlStream.closeNode();\n      xmlStream.closeNode();\n    },\n\n    parseOpen(node) {\n      if (this.parser) {\n        this.parser.parseOpen(node);\n        return true;\n      }\n      switch (node.name) {\n        case 'commentList':\n          this.model = {\n            comments: [],\n          };\n          return true;\n        case 'comment':\n          this.parser = this.map.comment;\n          this.parser.parseOpen(node);\n          return true;\n        default:\n          return false;\n      }\n    },\n    parseText(text) {\n      if (this.parser) {\n        this.parser.parseText(text);\n      }\n    },\n    parseClose(name) {\n      switch (name) {\n        case 'commentList':\n          return false;\n        case 'comment':\n          this.model.comments.push(this.parser.model);\n          this.parser = undefined;\n          return true;\n        default:\n          if (this.parser) {\n            this.parser.parseClose(name);\n          }\n          return true;\n      }\n    },\n  }\n);\n"],"mappings":";;AAAA,IAAMA,SAAS,GAAGC,OAAO,CAAC,2BAAD,CAAzB;;AACA,IAAMC,KAAK,GAAGD,OAAO,CAAC,sBAAD,CAArB;;AACA,IAAME,SAAS,GAAGF,OAAO,CAAC,eAAD,CAAzB;;AAEA,IAAMG,YAAY,GAAGH,OAAO,CAAC,iBAAD,CAA5B;;AAEA,IAAMI,aAAa,GAAIC,MAAM,CAACC,OAAP,GAAiB,YAAW;EACjD,KAAKC,GAAL,GAAW;IACTC,OAAO,EAAE,IAAIL,YAAJ;EADA,CAAX;AAGD,CAJD;;AAMAF,KAAK,CAACQ,QAAN,CACEL,aADF,EAEEF,SAFF,EAGE;EACEQ,mBAAmB,EAAE;IACnBC,KAAK,EAAE;EADY;AADvB,CAHF,EAQE;EACEC,MADF,kBACSC,SADT,EACoBC,KADpB,EAC2B;IAAA;;IACvBA,KAAK,GAAGA,KAAK,IAAI,KAAKA,KAAtB;IACAD,SAAS,CAACE,OAAV,CAAkBhB,SAAS,CAACiB,gBAA5B;IACAH,SAAS,CAACI,QAAV,CAAmB,UAAnB,EAA+Bb,aAAa,CAACM,mBAA7C,EAHuB,CAKvB;IACA;;IACAG,SAAS,CAACI,QAAV,CAAmB,SAAnB;IACAJ,SAAS,CAACK,QAAV,CAAmB,QAAnB,EAA6B,IAA7B,EAAmC,QAAnC;IACAL,SAAS,CAACM,SAAV,GATuB,CAWvB;;IACAN,SAAS,CAACI,QAAV,CAAmB,aAAnB;IACAH,KAAK,CAACM,QAAN,CAAeC,OAAf,CAAuB,UAAAb,OAAO,EAAI;MAChC,KAAI,CAACD,GAAL,CAASC,OAAT,CAAiBI,MAAjB,CAAwBC,SAAxB,EAAmCL,OAAnC;IACD,CAFD;IAGAK,SAAS,CAACM,SAAV;IACAN,SAAS,CAACM,SAAV;EACD,CAnBH;EAqBEG,SArBF,qBAqBYC,IArBZ,EAqBkB;IACd,IAAI,KAAKC,MAAT,EAAiB;MACf,KAAKA,MAAL,CAAYF,SAAZ,CAAsBC,IAAtB;MACA,OAAO,IAAP;IACD;;IACD,QAAQA,IAAI,CAACE,IAAb;MACE,KAAK,aAAL;QACE,KAAKX,KAAL,GAAa;UACXM,QAAQ,EAAE;QADC,CAAb;QAGA,OAAO,IAAP;;MACF,KAAK,SAAL;QACE,KAAKI,MAAL,GAAc,KAAKjB,GAAL,CAASC,OAAvB;QACA,KAAKgB,MAAL,CAAYF,SAAZ,CAAsBC,IAAtB;QACA,OAAO,IAAP;;MACF;QACE,OAAO,KAAP;IAXJ;EAaD,CAvCH;EAwCEG,SAxCF,qBAwCYC,IAxCZ,EAwCkB;IACd,IAAI,KAAKH,MAAT,EAAiB;MACf,KAAKA,MAAL,CAAYE,SAAZ,CAAsBC,IAAtB;IACD;EACF,CA5CH;EA6CEC,UA7CF,sBA6CaH,IA7Cb,EA6CmB;IACf,QAAQA,IAAR;MACE,KAAK,aAAL;QACE,OAAO,KAAP;;MACF,KAAK,SAAL;QACE,KAAKX,KAAL,CAAWM,QAAX,CAAoBS,IAApB,CAAyB,KAAKL,MAAL,CAAYV,KAArC;QACA,KAAKU,MAAL,GAAcM,SAAd;QACA,OAAO,IAAP;;MACF;QACE,IAAI,KAAKN,MAAT,EAAiB;UACf,KAAKA,MAAL,CAAYI,UAAZ,CAAuBH,IAAvB;QACD;;QACD,OAAO,IAAP;IAXJ;EAaD;AA3DH,CARF"}