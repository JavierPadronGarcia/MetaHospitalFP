{"version":3,"file":"comment-xform.js","names":["RichTextXform","require","utils","BaseXform","CommentXform","module","exports","model","inherits","tag","richTextXform","_richTextXform","render","xmlStream","openNode","ref","authorId","note","texts","forEach","text","closeNode","parseOpen","node","parser","name","type","attributes","parseText","parseClose","push","undefined"],"sources":["../../../../../lib/xlsx/xform/comment/comment-xform.js"],"sourcesContent":["const RichTextXform = require('../strings/rich-text-xform');\nconst utils = require('../../../utils/utils');\nconst BaseXform = require('../base-xform');\n\n/**\n  <comment ref=\"B1\" authorId=\"0\">\n    <text>\n      <r>\n        <rPr>\n          <b/>\n          <sz val=\"9\"/>\n          <rFont val=\"宋体\"/>\n          <charset val=\"134\"/>\n        </rPr>\n        <t>51422:</t>\n      </r>\n      <r>\n        <rPr>\n          <sz val=\"9\"/>\n          <rFont val=\"宋体\"/>\n          <charset val=\"134\"/>\n        </rPr>\n        <t xml:space=\"preserve\">&#10;test</t>\n      </r>\n    </text>\n  </comment>\n */\n\nconst CommentXform = (module.exports = function(model) {\n  this.model = model;\n});\n\nutils.inherits(CommentXform, BaseXform, {\n  get tag() {\n    return 'r';\n  },\n\n  get richTextXform() {\n    if (!this._richTextXform) {\n      this._richTextXform = new RichTextXform();\n    }\n    return this._richTextXform;\n  },\n\n  render(xmlStream, model) {\n    model = model || this.model;\n\n    xmlStream.openNode('comment', {\n      ref: model.ref,\n      authorId: 0,\n    });\n    xmlStream.openNode('text');\n    if (model && model.note && model.note.texts) {\n      model.note.texts.forEach(text => {\n        this.richTextXform.render(xmlStream, text);\n      });\n    }\n    xmlStream.closeNode();\n    xmlStream.closeNode();\n  },\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    switch (node.name) {\n      case 'comment':\n        this.model = {\n          type: 'note',\n          note: {\n            texts: [],\n          },\n          ...node.attributes,\n        };\n        return true;\n      case 'r':\n        this.parser = this.richTextXform;\n        this.parser.parseOpen(node);\n        return true;\n      default:\n        return false;\n    }\n  },\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  },\n  parseClose(name) {\n    switch (name) {\n      case 'comment':\n        return false;\n      case 'r':\n        this.model.note.texts.push(this.parser.model);\n        this.parser = undefined;\n        return true;\n      default:\n        if (this.parser) {\n          this.parser.parseClose(name);\n        }\n        return true;\n    }\n  },\n});\n"],"mappings":";;;;;;;;AAAA,IAAMA,aAAa,GAAGC,OAAO,CAAC,4BAAD,CAA7B;;AACA,IAAMC,KAAK,GAAGD,OAAO,CAAC,sBAAD,CAArB;;AACA,IAAME,SAAS,GAAGF,OAAO,CAAC,eAAD,CAAzB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,IAAMG,YAAY,GAAIC,MAAM,CAACC,OAAP,GAAiB,UAASC,KAAT,EAAgB;EACrD,KAAKA,KAAL,GAAaA,KAAb;AACD,CAFD;;AAIAL,KAAK,CAACM,QAAN,CAAeJ,YAAf,EAA6BD,SAA7B,EAAwC;EACtC,IAAIM,GAAJ,GAAU;IACR,OAAO,GAAP;EACD,CAHqC;;EAKtC,IAAIC,aAAJ,GAAoB;IAClB,IAAI,CAAC,KAAKC,cAAV,EAA0B;MACxB,KAAKA,cAAL,GAAsB,IAAIX,aAAJ,EAAtB;IACD;;IACD,OAAO,KAAKW,cAAZ;EACD,CAVqC;;EAYtCC,MAZsC,kBAY/BC,SAZ+B,EAYpBN,KAZoB,EAYb;IAAA;;IACvBA,KAAK,GAAGA,KAAK,IAAI,KAAKA,KAAtB;IAEAM,SAAS,CAACC,QAAV,CAAmB,SAAnB,EAA8B;MAC5BC,GAAG,EAAER,KAAK,CAACQ,GADiB;MAE5BC,QAAQ,EAAE;IAFkB,CAA9B;IAIAH,SAAS,CAACC,QAAV,CAAmB,MAAnB;;IACA,IAAIP,KAAK,IAAIA,KAAK,CAACU,IAAf,IAAuBV,KAAK,CAACU,IAAN,CAAWC,KAAtC,EAA6C;MAC3CX,KAAK,CAACU,IAAN,CAAWC,KAAX,CAAiBC,OAAjB,CAAyB,UAAAC,IAAI,EAAI;QAC/B,KAAI,CAACV,aAAL,CAAmBE,MAAnB,CAA0BC,SAA1B,EAAqCO,IAArC;MACD,CAFD;IAGD;;IACDP,SAAS,CAACQ,SAAV;IACAR,SAAS,CAACQ,SAAV;EACD,CA3BqC;EA6BtCC,SA7BsC,qBA6B5BC,IA7B4B,EA6BtB;IACd,IAAI,KAAKC,MAAT,EAAiB;MACf,KAAKA,MAAL,CAAYF,SAAZ,CAAsBC,IAAtB;MACA,OAAO,IAAP;IACD;;IACD,QAAQA,IAAI,CAACE,IAAb;MACE,KAAK,SAAL;QACE,KAAKlB,KAAL;UACEmB,IAAI,EAAE,MADR;UAEET,IAAI,EAAE;YACJC,KAAK,EAAE;UADH;QAFR,GAKKK,IAAI,CAACI,UALV;QAOA,OAAO,IAAP;;MACF,KAAK,GAAL;QACE,KAAKH,MAAL,GAAc,KAAKd,aAAnB;QACA,KAAKc,MAAL,CAAYF,SAAZ,CAAsBC,IAAtB;QACA,OAAO,IAAP;;MACF;QACE,OAAO,KAAP;IAfJ;EAiBD,CAnDqC;EAoDtCK,SApDsC,qBAoD5BR,IApD4B,EAoDtB;IACd,IAAI,KAAKI,MAAT,EAAiB;MACf,KAAKA,MAAL,CAAYI,SAAZ,CAAsBR,IAAtB;IACD;EACF,CAxDqC;EAyDtCS,UAzDsC,sBAyD3BJ,IAzD2B,EAyDrB;IACf,QAAQA,IAAR;MACE,KAAK,SAAL;QACE,OAAO,KAAP;;MACF,KAAK,GAAL;QACE,KAAKlB,KAAL,CAAWU,IAAX,CAAgBC,KAAhB,CAAsBY,IAAtB,CAA2B,KAAKN,MAAL,CAAYjB,KAAvC;QACA,KAAKiB,MAAL,GAAcO,SAAd;QACA,OAAO,IAAP;;MACF;QACE,IAAI,KAAKP,MAAT,EAAiB;UACf,KAAKA,MAAL,CAAYK,UAAZ,CAAuBJ,IAAvB;QACD;;QACD,OAAO,IAAP;IAXJ;EAaD;AAvEqC,CAAxC"}