{"version":3,"file":"column.js","names":["_","require","Enums","colCache","Column","worksheet","number","defn","_worksheet","_number","n2l","width","undefined","header","_header","key","style","hidden","outlineLevel","value","_hidden","_key","Array","headers","forEach","text","index","getCell","column","getColumnKey","deleteColumnKey","setColumnKey","_outlineLevel","properties","outlineLevelCol","JSON","stringify","length","other","isEqual","isCustomWidth","s","font","numFmt","alignment","border","fill","protection","options","iteratee","colNumber","eachRow","row","rowNumber","v","eachCell","cell","type","ValueType","Null","offset","hasOwnProperty","name","_applyStyle","columns","cols","col","isDefault","equivalentTo","min","max","collapsed","push","count","module","exports"],"sources":["../../../lib/doc/column.js"],"sourcesContent":["'use strict';\n\nconst _ = require('../utils/under-dash');\n\nconst Enums = require('./enums');\nconst colCache = require('../utils/col-cache');\n\n// Column defines the column properties for 1 column.\n// This includes header rows, widths, key, (style), etc.\n// Worksheet will condense the columns as appropriate during serialization\nclass Column {\n  constructor(worksheet, number, defn) {\n    this._worksheet = worksheet;\n    this._number = number;\n    if (defn !== false) {\n      // sometimes defn will follow\n      this.defn = defn;\n    }\n  }\n\n  get number() {\n    return this._number;\n  }\n\n  get worksheet() {\n    return this._worksheet;\n  }\n\n  get letter() {\n    return colCache.n2l(this._number);\n  }\n\n  get isCustomWidth() {\n    return this.width !== undefined && this.width !== 8;\n  }\n\n  get defn() {\n    return {\n      header: this._header,\n      key: this.key,\n      width: this.width,\n      style: this.style,\n      hidden: this.hidden,\n      outlineLevel: this.outlineLevel,\n    };\n  }\n\n  set defn(value) {\n    if (value) {\n      this.key = value.key;\n      this.width = value.width;\n      this.outlineLevel = value.outlineLevel;\n      if (value.style) {\n        this.style = value.style;\n      } else {\n        this.style = {};\n      }\n\n      // headers must be set after style\n      this.header = value.header;\n      this._hidden = !!value.hidden;\n    } else {\n      delete this._header;\n      delete this._key;\n      delete this.width;\n      this.style = {};\n      this.outlineLevel = 0;\n    }\n  }\n\n  get headers() {\n    return this._header && this._header instanceof Array ? this._header : [this._header];\n  }\n\n  get header() {\n    return this._header;\n  }\n\n  set header(value) {\n    if (value !== undefined) {\n      this._header = value;\n      this.headers.forEach((text, index) => {\n        this._worksheet.getCell(index + 1, this.number).value = text;\n      });\n    } else {\n      this._header = undefined;\n    }\n  }\n\n  get key() {\n    return this._key;\n  }\n\n  set key(value) {\n    const column = this._key && this._worksheet.getColumnKey(this._key);\n    if (column === this) {\n      this._worksheet.deleteColumnKey(this._key);\n    }\n\n    this._key = value;\n    if (value) {\n      this._worksheet.setColumnKey(this._key, this);\n    }\n  }\n\n  get hidden() {\n    return !!this._hidden;\n  }\n\n  set hidden(value) {\n    this._hidden = value;\n  }\n\n  get outlineLevel() {\n    return this._outlineLevel || 0;\n  }\n\n  set outlineLevel(value) {\n    this._outlineLevel = value;\n  }\n\n  get collapsed() {\n    return !!(this._outlineLevel && this._outlineLevel >= this._worksheet.properties.outlineLevelCol);\n  }\n\n  toString() {\n    return JSON.stringify({\n      key: this.key,\n      width: this.width,\n      headers: this.headers.length ? this.headers : undefined,\n    });\n  }\n\n  equivalentTo(other) {\n    return this.width === other.width && this.hidden === other.hidden && this.outlineLevel === other.outlineLevel && _.isEqual(this.style, other.style);\n  }\n\n  get isDefault() {\n    if (this.isCustomWidth) {\n      return false;\n    }\n    if (this.hidden) {\n      return false;\n    }\n    if (this.outlineLevel) {\n      return false;\n    }\n    const s = this.style;\n    if (s && (s.font || s.numFmt || s.alignment || s.border || s.fill || s.protection)) {\n      return false;\n    }\n    return true;\n  }\n\n  get headerCount() {\n    return this.headers.length;\n  }\n\n  eachCell(options, iteratee) {\n    const colNumber = this.number;\n    if (!iteratee) {\n      iteratee = options;\n      options = null;\n    }\n    this._worksheet.eachRow(options, (row, rowNumber) => {\n      iteratee(row.getCell(colNumber), rowNumber);\n    });\n  }\n\n  get values() {\n    const v = [];\n    this.eachCell((cell, rowNumber) => {\n      if (cell && cell.type !== Enums.ValueType.Null) {\n        v[rowNumber] = cell.value;\n      }\n    });\n    return v;\n  }\n\n  set values(v) {\n    if (!v) {\n      return;\n    }\n    const colNumber = this.number;\n    let offset = 0;\n    if (v.hasOwnProperty('0')) {\n      // assume contiguous array, start at row 1\n      offset = 1;\n    }\n    v.forEach((value, index) => {\n      this._worksheet.getCell(index + offset, colNumber).value = value;\n    });\n  }\n\n  // =========================================================================\n  // styles\n  _applyStyle(name, value) {\n    this.style[name] = value;\n    this.eachCell(cell => {\n      cell[name] = value;\n    });\n    return value;\n  }\n\n  get numFmt() {\n    return this.style.numFmt;\n  }\n\n  set numFmt(value) {\n    this._applyStyle('numFmt', value);\n  }\n\n  get font() {\n    return this.style.font;\n  }\n\n  set font(value) {\n    this._applyStyle('font', value);\n  }\n\n  get alignment() {\n    return this.style.alignment;\n  }\n\n  set alignment(value) {\n    this._applyStyle('alignment', value);\n  }\n\n  get protection() {\n    return this.style.protection;\n  }\n\n  set protection(value) {\n    this._applyStyle('protection', value);\n  }\n\n  get border() {\n    return this.style.border;\n  }\n\n  set border(value) {\n    this._applyStyle('border', value);\n  }\n\n  get fill() {\n    return this.style.fill;\n  }\n\n  set fill(value) {\n    this._applyStyle('fill', value);\n  }\n\n  // =============================================================================\n  // static functions\n\n  static toModel(columns) {\n    // Convert array of Column into compressed list cols\n    const cols = [];\n    let col = null;\n    if (columns) {\n      columns.forEach((column, index) => {\n        if (column.isDefault) {\n          if (col) {\n            col = null;\n          }\n        } else if (!col || !column.equivalentTo(col)) {\n          col = {\n            min: index + 1,\n            max: index + 1,\n            width: column.width,\n            style: column.style,\n            isCustomWidth: column.isCustomWidth,\n            hidden: column.hidden,\n            outlineLevel: column.outlineLevel,\n            collapsed: column.collapsed,\n          };\n          cols.push(col);\n        } else {\n          col.max = index + 1;\n        }\n      });\n    }\n    return cols.length ? cols : undefined;\n  }\n\n  static fromModel(worksheet, cols) {\n    cols = cols || [];\n    const columns = [];\n    let count = 1;\n    let index = 0;\n    while (index < cols.length) {\n      const col = cols[index++];\n      while (count < col.min) {\n        columns.push(new Column(worksheet, count++));\n      }\n      while (count <= col.max) {\n        columns.push(new Column(worksheet, count++, col));\n      }\n    }\n    return columns.length ? columns : null;\n  }\n}\n\nmodule.exports = Column;\n"],"mappings":"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"}