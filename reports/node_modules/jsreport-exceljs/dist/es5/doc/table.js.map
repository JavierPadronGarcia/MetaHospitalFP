{"version":3,"file":"table.js","names":["colCache","require","Column","table","column","index","name","value","cacheState","_set","filterButton","style","totalsRowLabel","totalsRowFunction","totalsRowResult","totalsRowFormula","Table","worksheet","validate","store","Error","columns","length","rows","height","headerRow","filterHeight","totalsRow","assign","o","dflt","undefined","assert","test","message","ref","tl","decodeAddress","row","col","width","tableHeight","autoFilterRef","encode","tableRef","forEach","i","getFormula","assignStyle","cell","Object","keys","key","count","r","getRow","j","getCell","data","formula","result","_cache","values","rowNumber","push","splice","rowIndex","colIndex","target","prop","_assign","displyName","displayName","showFirstColumn","showLastColumn","showRowStripes","showColumnStripes","module","exports"],"sources":["../../../lib/doc/table.js"],"sourcesContent":["/* eslint-disable max-classes-per-file */\nconst colCache = require('./../utils/col-cache');\n\nclass Column {\n  // wrapper around column model, allowing access and manipulation\n  constructor(table, column, index) {\n    this.table = table;\n    this.column = column;\n    this.index = index;\n  }\n\n  _set(name, value) {\n    this.table.cacheState();\n    this.column[name] = value;\n  }\n\n  /* eslint-disable lines-between-class-members */\n  get name() { return this.column.name; }\n  set name(value) { this._set('name', value); }\n\n  get filterButton() { return this.column.filterButton; }\n  set filterButton(value) { this.column.filterButton = value; }\n\n  get style() { return this.column.style; }\n  set style(value) { this.column.style = value; }\n\n  get totalsRowLabel() { return this.column.totalsRowLabel; }\n  set totalsRowLabel(value) { this._set('totalsRowLabel', value); }\n\n  get totalsRowFunction() { return this.column.totalsRowFunction; }\n  set totalsRowFunction(value) { this._set('totalsRowFunction', value); }\n\n  get totalsRowResult() { return this.column.totalsRowResult; }\n  set totalsRowResult(value) { this._set('totalsRowResult', value); }\n\n  get totalsRowFormula() { return this.column.totalsRowFormula; }\n  set totalsRowFormula(value) { this._set('totalsRowFormula', value); }\n  /* eslint-enable lines-between-class-members */\n}\n\nclass Table {\n  constructor(worksheet, table) {\n    this.worksheet = worksheet;\n    if (table) {\n      this.table = table;\n      // check things are ok first\n      this.validate();\n\n      this.store();\n    }\n  }\n\n  getFormula(column) {\n    // get the correct formula to apply to the totals row\n    switch (column.totalsRowFunction) {\n      case 'none': return null;\n      case 'average': return `SUBTOTAL(101,${this.table.name}[${column.name}])`;\n      case 'countNums': return `SUBTOTAL(102,${this.table.name}[${column.name}])`;\n      case 'count': return `SUBTOTAL(103,${this.table.name}[${column.name}])`;\n      case 'max': return `SUBTOTAL(104,${this.table.name}[${column.name}])`;\n      case 'min': return `SUBTOTAL(105,${this.table.name}[${column.name}])`;\n      case 'stdDev': return `SUBTOTAL(106,${this.table.name}[${column.name}])`;\n      case 'var': return `SUBTOTAL(107,${this.table.name}[${column.name}])`;\n      case 'sum': return `SUBTOTAL(109,${this.table.name}[${column.name}])`;\n      case 'custom': return column.totalsRowFormula;\n      default:\n        throw new Error(`Invalid Totals Row Function: ${column.totalsRowFunction}`);\n    }\n  }\n\n  get width() {\n    // width of the table\n    return this.table.columns.length;\n  }\n\n  get height() {\n    // height of the table data\n    return this.table.rows.length;\n  }\n\n  get filterHeight() {\n    // height of the table data plus optional header row\n    return this.height + (this.table.headerRow ? 1 : 0);\n  }\n\n  get tableHeight() {\n    // full height of the table on the sheet\n    return this.filterHeight + (this.table.totalsRow ? 1 : 0);\n  }\n\n  validate() {\n    const {table} = this;\n    // set defaults and check is valid\n    const assign = (o, name, dflt) => {\n      if (o[name] === undefined) {\n        o[name] = dflt;\n      }\n    };\n    assign(table, 'headerRow', true);\n    assign(table, 'totalsRow', false);\n\n    assign(table, 'style', {});\n    assign(table.style, 'theme', 'TableStyleMedium2');\n    assign(table.style, 'showFirstColumn', false);\n    assign(table.style, 'showLastColumn', false);\n    assign(table.style, 'showRowStripes', false);\n    assign(table.style, 'showColumnStripes', false);\n\n    const assert = (test, message) => {\n      if (!test) {\n        throw new Error(message);\n      }\n    };\n    assert(table.ref, 'Table must have ref');\n    assert(table.columns, 'Table must have column definitions');\n    assert(table.rows, 'Table must have row definitions');\n\n    table.tl = colCache.decodeAddress(table.ref);\n    const {row, col} = table.tl;\n    assert(row > 0, 'Table must be on valid row');\n    assert(col > 0, 'Table must be on valid col');\n\n    const {width, filterHeight, tableHeight} = this;\n\n    // autoFilterRef is a range that includes optional headers only\n    table.autoFilterRef = colCache.encode(\n      row,\n      col,\n      row + filterHeight - 1,\n      col + width - 1\n    );\n\n    // tableRef is a range that includes optional headers and totals\n    table.tableRef = colCache.encode(\n      row,\n      col,\n      row + tableHeight - 1,\n      col + width - 1\n    );\n\n    table.columns.forEach((column, i) => {\n      assert(column.name, `Column ${i} must have a name`);\n      if (i === 0) {\n        assign(column, 'totalsRowLabel', 'Total');\n      } else {\n        assign(column, 'totalsRowFunction', 'none');\n        column.totalsRowFormula = this.getFormula(column);\n      }\n    });\n  }\n\n  store() {\n    // where the table needs to store table data, headers, footers in\n    // the sheet...\n    const assignStyle = (cell, style) => {\n      if (style) {\n        Object.keys(style).forEach(key => {\n          cell[key] = style[key];\n        });\n      }\n    };\n\n    const {worksheet, table} = this;\n    const {row, col} = table.tl;\n    let count = 0;\n    if (table.headerRow) {\n      const r = worksheet.getRow(row + count++);\n      table.columns.forEach((column, j) => {\n        const {style, name} = column;\n        const cell = r.getCell(col + j);\n        cell.value = name;\n        assignStyle(cell, style);\n      });\n    }\n    table.rows.forEach(data => {\n      const r = worksheet.getRow(row + count++);\n      data.forEach((value, j) => {\n        const cell = r.getCell(col + j);\n        cell.value = value;\n\n        assignStyle(cell, table.columns[j].style);\n      });\n    });\n\n    if (table.totalsRow) {\n      const r = worksheet.getRow(row + count++);\n      table.columns.forEach((column, j) => {\n        const cell = r.getCell(col + j);\n        if (j === 0) {\n          cell.value = column.totalsRowLabel;\n        } else {\n          const formula = this.getFormula(column);\n          if (formula) {\n            cell.value = {\n              formula: column.totalsRowFormula,\n              result: column.totalsRowResult,\n            };\n          } else {\n            cell.value = null;\n          }\n        }\n\n        assignStyle(cell, column.style);\n      });\n    }\n  }\n\n  load(worksheet) {\n    // where the table will read necessary features from a loaded sheet\n    const {table} = this;\n    const {row, col} = table.tl;\n    let count = 0;\n    if (table.headerRow) {\n      const r = worksheet.getRow(row + count++);\n      table.columns.forEach((column, j) => {\n        const cell = r.getCell(col + j);\n        cell.value = column.name;\n      });\n    }\n    table.rows.forEach(data => {\n      const r = worksheet.getRow(row + count++);\n      data.forEach((value, j) => {\n        const cell = r.getCell(col + j);\n        cell.value = value;\n      });\n    });\n\n    if (table.totalsRow) {\n      const r = worksheet.getRow(row + count++);\n      table.columns.forEach((column, j) => {\n        const cell = r.getCell(col + j);\n        if (j === 0) {\n          cell.value = column.totalsRowLabel;\n        } else {\n          const formula = this.getFormula(column);\n          if (formula) {\n            cell.value = {\n              formula: column.totalsRowFormula,\n              result: column.totalsRowResult,\n            };\n          }\n        }\n      });\n    }\n  }\n\n  get model() {\n    return this.table;\n  }\n\n  set model(value) {\n    this.table = value;\n  }\n\n  // ================================================================\n  // TODO: Mutating methods\n  cacheState() {\n    if (!this._cache) {\n      this._cache = {\n        ref: this.ref,\n        width: this.width,\n        tableHeight: this.tableHeight,\n      };\n    }\n  }\n\n  commit() {\n    // changes may have been made that might have on-sheet effects\n    if (!this._cache) {\n      return;\n    }\n\n    // check things are ok first\n    this.validate();\n\n    const ref = colCache.decodeAddress(this._cache.ref);\n    if (this.ref !== this._cache.ref) {\n      // wipe out whole table footprint at previous location\n      for (let i = 0; i < this._cache.tableHeight; i++) {\n        const row = this.worksheet.getRow(ref.row + i);\n        for (let j = 0; j < this._cache.width; j++) {\n          const cell = row.getCell(ref.col + j);\n          cell.value = null;\n        }\n      }\n    } else {\n      // clear out below table if it has shrunk\n      for (let i = this.tableHeight; i < this._cache.tableHeight; i++) {\n        const row = this.worksheet.getRow(ref.row + i);\n        for (let j = 0; j < this._cache.width; j++) {\n          const cell = row.getCell(ref.col + j);\n          cell.value = null;\n        }\n      }\n\n      // clear out to right of table if it has lost columns\n      for (let i = 0; i < this.tableHeight; i++) {\n        const row = this.worksheet.getRow(ref.row + i);\n        for (let j = this.width; j < this._cache.width; j++) {\n          const cell = row.getCell(ref.col + j);\n          cell.value = null;\n        }\n      }\n    }\n\n    this.store();\n  }\n\n  addRow(values, rowNumber) {\n    // Add a row of data, either insert at rowNumber or append\n    this.cacheState();\n\n    if (rowNumber === undefined) {\n      this.table.rows.push(values);\n    } else {\n      this.table.rows.splice(rowNumber, 0, values);\n    }\n  }\n\n  removeRows(rowIndex, count = 1) {\n    // Remove a rows of data\n    this.cacheState();\n    this.table.rows.splice(rowIndex, count);\n  }\n\n  getColumn(colIndex) {\n    const column = this.table.columns[colIndex];\n    return new Column(this, column, colIndex);\n  }\n\n  addColumn(column, values, colIndex) {\n    // Add a new column, including column defn and values\n    // Inserts at colNumber or adds to the right\n    this.cacheState();\n\n    if (colIndex === undefined) {\n      this.table.columns.push(column);\n      this.table.rows.forEach((row, i) => {\n        row.push(values[i]);\n      });\n    } else {\n      this.table.columns.splice(colIndex, 0, column);\n      this.table.rows.forEach((row, i) => {\n        row.splice(colIndex, 0, values[i]);\n      });\n    }\n  }\n\n  removeColumns(colIndex, count = 1) {\n    // Remove a column with data\n    this.cacheState();\n\n    this.table.columns.splice(colIndex, count);\n    this.table.rows.forEach(row => {\n      row.splice(colIndex, count);\n    });\n  }\n\n  _assign(target, prop, value) {\n    this.cacheState();\n    target[prop] = value;\n  }\n\n  /* eslint-disable lines-between-class-members */\n  get ref() { return this.table.ref; }\n  set ref(value) { this._assign(this.table, 'ref', value); }\n\n  get name() { return this.table.name; }\n  set name(value) { this.table.name = value; }\n\n  get displayName() { return this.table.displyName || this.table.name; }\n  set displayNamename(value) { this.table.displayName = value; }\n\n  get headerRow() { return this.table.headerRow; }\n  set headerRow(value) { this._assign(this.table, 'headerRow', value); }\n\n  get totalsRow() { return this.table.totalsRow; }\n  set totalsRow(value) { this._assign(this.table, 'totalsRow', value); }\n\n  get theme() { return this.table.style.name; }\n  set theme(value) { this.table.style.name = value; }\n\n  get showFirstColumn() { return this.table.style.showFirstColumn; }\n  set showFirstColumn(value) { this.table.style.showFirstColumn = value; }\n\n  get showLastColumn() { return this.table.style.showLastColumn; }\n  set showLastColumn(value) { this.table.style.showLastColumn = value; }\n\n  get showRowStripes() { return this.table.style.showRowStripes; }\n  set showRowStripes(value) { this.table.style.showRowStripes = value; }\n\n  get showColumnStripes() { return this.table.style.showColumnStripes; }\n  set showColumnStripes(value) { this.table.style.showColumnStripes = value; }\n  /* eslint-enable lines-between-class-members */\n\n}\n\nmodule.exports = Table;\n"],"mappings":"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"}