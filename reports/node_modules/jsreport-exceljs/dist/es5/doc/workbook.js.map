{"version":3,"file":"workbook.js","names":["Worksheet","require","DefinedNames","XLSX","CSV","Workbook","created","Date","modified","properties","calcProperties","_worksheets","views","media","_definedNames","_xlsx","_csv","i","length","name","options","id","nextId","console","warn","substring","find","ws","toLowerCase","Error","trace","tabColor","argb","theme","indexed","lastOrderNo","reduce","acc","orderNo","worksheetOptions","Object","assign","workbook","worksheet","getWorksheet","destroy","undefined","Boolean","slice","sort","a","b","filter","iteratee","worksheets","forEach","sheet","_themes","image","push","type","creator","lastModifiedBy","lastPrinted","map","model","sheets","definedNames","company","manager","title","subject","keywords","category","description","language","revision","contentStatus","themes","value","worksheetModel","state","findIndex","module","exports"],"sources":["../../../lib/doc/workbook.js"],"sourcesContent":["'use strict';\n\nconst Worksheet = require('./worksheet');\nconst DefinedNames = require('./defined-names');\nconst XLSX = require('./../xlsx/xlsx');\nconst CSV = require('./../csv/csv');\n\n// Workbook requirements\n//  Load and Save from file and stream\n//  Access/Add/Delete individual worksheets\n//  Manage String table, Hyperlink table, etc.\n//  Manage scaffolding for contained objects to write to/read from\n\nclass Workbook {\n  constructor() {\n    this.created = new Date();\n    this.modified = this.created;\n    this.properties = {};\n    this.calcProperties = {};\n    this._worksheets = [];\n    this.views = [];\n    this.media = [];\n    this._definedNames = new DefinedNames();\n  }\n\n  get xlsx() {\n    if (!this._xlsx) this._xlsx = new XLSX(this);\n    return this._xlsx;\n  }\n\n  get csv() {\n    if (!this._csv) this._csv = new CSV(this);\n    return this._csv;\n  }\n\n  get nextId() {\n    // find the next unique spot to add worksheet\n    for (let i = 1; i < this._worksheets.length; i++) {\n      if (!this._worksheets[i]) {\n        return i;\n      }\n    }\n    return this._worksheets.length || 1;\n  }\n\n  addWorksheet(name, options) {\n    const id = this.nextId;\n\n    if (name && (name.length > 31)) {\n      // eslint-disable-next-line no-console\n      console.warn(`Worksheet name ${name} exceeds 31 chars. This will be truncated`);\n    }\n    name = (name || `sheet${id}`).substring(0, 31);\n    if (this._worksheets.find(ws => ws && ws.name.toLowerCase() === name.toLowerCase())) {\n      throw new Error(`Worksheet name already exists: ${name}`);\n    }\n\n    // if options is a color, call it tabColor (and signal deprecated message)\n    if (options) {\n      if (typeof options === 'string') {\n        // eslint-disable-next-line no-console\n        console.trace('tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { argb: \"rbg value\" } }');\n        options = {\n          properties: {\n            tabColor: {argb: options},\n          },\n        };\n      } else if (options.argb || options.theme || options.indexed) {\n        // eslint-disable-next-line no-console\n        console.trace('tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { ... } }');\n        options = {\n          properties: {\n            tabColor: options,\n          },\n        };\n      }\n    }\n\n    const lastOrderNo = this._worksheets.reduce((acc, ws) => ((ws && ws.orderNo) > acc ? ws.orderNo : acc), 0);\n    const worksheetOptions = Object.assign({}, options, {\n      id,\n      name,\n      orderNo: lastOrderNo + 1,\n      workbook: this,\n    });\n\n    const worksheet = new Worksheet(worksheetOptions);\n\n    this._worksheets[id] = worksheet;\n    return worksheet;\n  }\n\n  removeWorksheetEx(worksheet) {\n    delete this._worksheets[worksheet.id];\n  }\n\n  removeWorksheet(id) {\n    const worksheet = this.getWorksheet(id);\n    if (worksheet) {\n      worksheet.destroy();\n    }\n  }\n\n  getWorksheet(id) {\n    if (id === undefined) {\n      return this._worksheets.find(Boolean);\n    }\n    if (typeof id === 'number') {\n      return this._worksheets[id];\n    }\n    if (typeof id === 'string') {\n      return this._worksheets.find(worksheet => worksheet && worksheet.name === id);\n    }\n    return undefined;\n  }\n\n  get worksheets() {\n    // return a clone of _worksheets\n    return this._worksheets\n      .slice(1)\n      .sort((a, b) => a.orderNo - b.orderNo)\n      .filter(Boolean);\n  }\n\n  eachSheet(iteratee) {\n    this.worksheets.forEach(sheet => {\n      iteratee(sheet, sheet.id);\n    });\n  }\n\n  get definedNames() {\n    return this._definedNames;\n  }\n\n  clearThemes() {\n    // Note: themes are not an exposed feature, meddle at your peril!\n    this._themes = undefined;\n  }\n\n  addImage(image) {\n    // TODO:  validation?\n    const id = this.media.length;\n    this.media.push(Object.assign({}, image, {type: 'image'}));\n    return id;\n  }\n\n  getImage(id) {\n    return this.media[id];\n  }\n\n  get model() {\n    return {\n      creator: this.creator || 'Unknown',\n      lastModifiedBy: this.lastModifiedBy || 'Unknown',\n      lastPrinted: this.lastPrinted,\n      created: this.created,\n      modified: this.modified,\n      properties: this.properties,\n      worksheets: this.worksheets.map(worksheet => worksheet.model),\n      sheets: this.worksheets.map(ws => ws.model).filter(Boolean),\n      definedNames: this._definedNames.model,\n      views: this.views,\n      company: this.company,\n      manager: this.manager,\n      title: this.title,\n      subject: this.subject,\n      keywords: this.keywords,\n      category: this.category,\n      description: this.description,\n      language: this.language,\n      revision: this.revision,\n      contentStatus: this.contentStatus,\n      themes: this._themes,\n      media: this.media,\n      calcProperties: this.calcProperties,\n    };\n  }\n\n  set model(value) {\n    this.creator = value.creator;\n    this.lastModifiedBy = value.lastModifiedBy;\n    this.lastPrinted = value.lastPrinted;\n    this.created = value.created;\n    this.modified = value.modified;\n    this.company = value.company;\n    this.manager = value.manager;\n    this.title = value.title;\n    this.subject = value.subject;\n    this.keywords = value.keywords;\n    this.category = value.category;\n    this.description = value.description;\n    this.language = value.language;\n    this.revision = value.revision;\n    this.contentStatus = value.contentStatus;\n\n    this.properties = value.properties;\n    this.calcProperties = value.calcProperties;\n    this._worksheets = [];\n    value.worksheets.forEach(worksheetModel => {\n      const {id, name, state} = worksheetModel;\n      const orderNo = value.sheets && value.sheets.findIndex(ws => ws.id === id);\n      const worksheet = (this._worksheets[id] = new Worksheet({\n        id,\n        name,\n        orderNo,\n        state,\n        workbook: this,\n      }));\n\n      worksheet.model = worksheetModel;\n    });\n\n    this._definedNames.model = value.definedNames;\n    this.views = value.views;\n    this._themes = value.themes;\n    this.media = value.media || [];\n  }\n}\n\nmodule.exports = Workbook;\n"],"mappings":"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"}