{"version":3,"file":"hyperlink-reader.js","names":["require","EventEmitter","Sax","Enums","RelType","HyperlinkReader","workbook","id","_workbook","hyperlinks","length","fn","forEach","entry","options","emitHyperlinks","autodrain","emit","parser","createStream","on","node","name","rId","attributes","Id","Type","Hyperlink","relationship","type","RelationshipType","Styles","target","Target","targetMode","TargetMode","flowControl","createChild","pipe","sync","module","exports"],"sources":["../../../../lib/stream/xlsx/hyperlink-reader.js"],"sourcesContent":["const {EventEmitter} = require('events');\nconst Sax = require('sax');\n\nconst Enums = require('../../doc/enums');\nconst RelType = require('../../xlsx/rel-type');\n\nclass HyperlinkReader extends EventEmitter {\n  constructor(workbook, id) {\n    super();\n\n    // in a workbook, each sheet will have a number\n    this.id = id;\n\n    this._workbook = workbook;\n  }\n\n  get count() {\n    return (this.hyperlinks && this.hyperlinks.length) || 0;\n  }\n\n  each(fn) {\n    return this.hyperlinks.forEach(fn);\n  }\n\n  read(entry, options) {\n    let emitHyperlinks = false;\n    let hyperlinks = null;\n    switch (options.hyperlinks) {\n      case 'emit':\n        emitHyperlinks = true;\n        break;\n      case 'cache':\n        this.hyperlinks = hyperlinks = {};\n        break;\n      default:\n        break;\n    }\n\n    if (!emitHyperlinks && !hyperlinks) {\n      entry.autodrain();\n      this.emit('finished');\n      return;\n    }\n\n    const parser = Sax.createStream(true, {});\n    parser.on('opentag', node => {\n      if (node.name === 'Relationship') {\n        const rId = node.attributes.Id;\n        switch (node.attributes.Type) {\n          case RelType.Hyperlink: {\n            const relationship = {\n              type: Enums.RelationshipType.Styles,\n              rId,\n              target: node.attributes.Target,\n              targetMode: node.attributes.TargetMode,\n            };\n            if (emitHyperlinks) {\n              this.emit('hyperlink', relationship);\n            } else {\n              hyperlinks[relationship.rId] = relationship;\n            }\n          }  break;\n\n          default:\n            break;\n        }\n      }\n    });\n\n    parser.on('end', () => {\n      this.emit('finished');\n    });\n\n    // create a down-stream flow-control to regulate the stream\n    const flowControl = this._workbook.flowControl.createChild();\n    flowControl.pipe(\n      parser,\n      {sync: true}\n    );\n    entry.pipe(flowControl);\n  }\n}\n\nmodule.exports = HyperlinkReader;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,eAAuBA,OAAO,CAAC,QAAD,CAA9B;AAAA,IAAOC,YAAP,YAAOA,YAAP;;AACA,IAAMC,GAAG,GAAGF,OAAO,CAAC,KAAD,CAAnB;;AAEA,IAAMG,KAAK,GAAGH,OAAO,CAAC,iBAAD,CAArB;;AACA,IAAMI,OAAO,GAAGJ,OAAO,CAAC,qBAAD,CAAvB;;IAEMK,e;;;;;EACJ,yBAAYC,QAAZ,EAAsBC,EAAtB,EAA0B;IAAA;;IAAA;;IACxB,0BADwB,CAGxB;;IACA,MAAKA,EAAL,GAAUA,EAAV;IAEA,MAAKC,SAAL,GAAiBF,QAAjB;IANwB;EAOzB;;;;SAED,eAAY;MACV,OAAQ,KAAKG,UAAL,IAAmB,KAAKA,UAAL,CAAgBC,MAApC,IAA+C,CAAtD;IACD;;;WAED,cAAKC,EAAL,EAAS;MACP,OAAO,KAAKF,UAAL,CAAgBG,OAAhB,CAAwBD,EAAxB,CAAP;IACD;;;WAED,cAAKE,KAAL,EAAYC,OAAZ,EAAqB;MAAA;;MACnB,IAAIC,cAAc,GAAG,KAArB;MACA,IAAIN,UAAU,GAAG,IAAjB;;MACA,QAAQK,OAAO,CAACL,UAAhB;QACE,KAAK,MAAL;UACEM,cAAc,GAAG,IAAjB;UACA;;QACF,KAAK,OAAL;UACE,KAAKN,UAAL,GAAkBA,UAAU,GAAG,EAA/B;UACA;;QACF;UACE;MARJ;;MAWA,IAAI,CAACM,cAAD,IAAmB,CAACN,UAAxB,EAAoC;QAClCI,KAAK,CAACG,SAAN;QACA,KAAKC,IAAL,CAAU,UAAV;QACA;MACD;;MAED,IAAMC,MAAM,GAAGhB,GAAG,CAACiB,YAAJ,CAAiB,IAAjB,EAAuB,EAAvB,CAAf;MACAD,MAAM,CAACE,EAAP,CAAU,SAAV,EAAqB,UAAAC,IAAI,EAAI;QAC3B,IAAIA,IAAI,CAACC,IAAL,KAAc,cAAlB,EAAkC;UAChC,IAAMC,GAAG,GAAGF,IAAI,CAACG,UAAL,CAAgBC,EAA5B;;UACA,QAAQJ,IAAI,CAACG,UAAL,CAAgBE,IAAxB;YACE,KAAKtB,OAAO,CAACuB,SAAb;cAAwB;gBACtB,IAAMC,YAAY,GAAG;kBACnBC,IAAI,EAAE1B,KAAK,CAAC2B,gBAAN,CAAuBC,MADV;kBAEnBR,GAAG,EAAHA,GAFmB;kBAGnBS,MAAM,EAAEX,IAAI,CAACG,UAAL,CAAgBS,MAHL;kBAInBC,UAAU,EAAEb,IAAI,CAACG,UAAL,CAAgBW;gBAJT,CAArB;;gBAMA,IAAIpB,cAAJ,EAAoB;kBAClB,MAAI,CAACE,IAAL,CAAU,WAAV,EAAuBW,YAAvB;gBACD,CAFD,MAEO;kBACLnB,UAAU,CAACmB,YAAY,CAACL,GAAd,CAAV,GAA+BK,YAA/B;gBACD;cACF;cAAE;;YAEH;cACE;UAhBJ;QAkBD;MACF,CAtBD;MAwBAV,MAAM,CAACE,EAAP,CAAU,KAAV,EAAiB,YAAM;QACrB,MAAI,CAACH,IAAL,CAAU,UAAV;MACD,CAFD,EA7CmB,CAiDnB;;MACA,IAAMmB,WAAW,GAAG,KAAK5B,SAAL,CAAe4B,WAAf,CAA2BC,WAA3B,EAApB;;MACAD,WAAW,CAACE,IAAZ,CACEpB,MADF,EAEE;QAACqB,IAAI,EAAE;MAAP,CAFF;MAIA1B,KAAK,CAACyB,IAAN,CAAWF,WAAX;IACD;;;;EA1E2BnC,Y;;AA6E9BuC,MAAM,CAACC,OAAP,GAAiBpC,eAAjB"}