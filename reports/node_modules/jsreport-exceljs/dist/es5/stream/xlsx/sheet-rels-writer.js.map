{"version":3,"file":"sheet-rels-writer.js","names":["utils","require","RelType","HyperlinksProxy","sheetRelsWriter","writer","hyperlink","addHyperlink","SheetRelsWriter","options","id","count","_hyperlinks","_workbook","workbook","_stream","_openStream","length","fn","forEach","_hyperlinksProxy","relationship","Target","target","Type","Hyperlink","TargetMode","rId","_writeRelationship","push","address","media","rel","_writeClose","stream","end","write","_writeOpen","xmlEncode","module","exports"],"sources":["../../../../lib/stream/xlsx/sheet-rels-writer.js"],"sourcesContent":["/* eslint-disable max-classes-per-file */\nconst utils = require('../../utils/utils');\nconst RelType = require('../../xlsx/rel-type');\n\nclass HyperlinksProxy {\n  constructor(sheetRelsWriter) {\n    this.writer = sheetRelsWriter;\n  }\n\n  push(hyperlink) {\n    this.writer.addHyperlink(hyperlink);\n  }\n}\n\nclass SheetRelsWriter {\n  constructor(options) {\n    // in a workbook, each sheet will have a number\n    this.id = options.id;\n\n    // count of all relationships\n    this.count = 0;\n\n    // keep record of all hyperlinks\n    this._hyperlinks = [];\n\n    this._workbook = options.workbook;\n  }\n\n  get stream() {\n    if (!this._stream) {\n      // eslint-disable-next-line no-underscore-dangle\n      this._stream = this._workbook._openStream(`/xl/worksheets/_rels/sheet${this.id}.xml.rels`);\n    }\n    return this._stream;\n  }\n\n  get length() {\n    return this._hyperlinks.length;\n  }\n\n  each(fn) {\n    return this._hyperlinks.forEach(fn);\n  }\n\n  get hyperlinksProxy() {\n    return this._hyperlinksProxy || (this._hyperlinksProxy = new HyperlinksProxy(this));\n  }\n\n  addHyperlink(hyperlink) {\n    // Write to stream\n    const relationship = {\n      Target: hyperlink.target,\n      Type: RelType.Hyperlink,\n      TargetMode: 'External',\n    };\n    const rId = this._writeRelationship(relationship);\n\n    // store sheet stuff for later\n    this._hyperlinks.push({\n      rId,\n      address: hyperlink.address,\n    });\n  }\n\n  addMedia(media) {\n    return this._writeRelationship(media);\n  }\n\n  addRelationship(rel) {\n    return this._writeRelationship(rel);\n  }\n\n  commit() {\n    if (this.count) {\n      // write xml utro\n      this._writeClose();\n      // and close stream\n      this.stream.end();\n    }\n  }\n\n  // ================================================================================\n  _writeOpen() {\n    this.stream.write(\n      `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n       <Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">`\n    );\n  }\n\n  _writeRelationship(relationship) {\n    if (!this.count) {\n      this._writeOpen();\n    }\n\n    const rId = `rId${++this.count}`;\n\n    if (relationship.TargetMode) {\n      this.stream.write(\n        `<Relationship Id=\"${rId}\"` +\n          ` Type=\"${relationship.Type}\"` +\n          ` Target=\"${utils.xmlEncode(relationship.Target)}\"` +\n          ` TargetMode=\"${relationship.TargetMode}\"` +\n          '/>'\n      );\n    } else {\n      this.stream.write(`<Relationship Id=\"${rId}\" Type=\"${relationship.Type}\" Target=\"${relationship.Target}\"/>`);\n    }\n\n    return rId;\n  }\n\n  _writeClose() {\n    this.stream.write('</Relationships>');\n  }\n}\n\nmodule.exports = SheetRelsWriter;\n"],"mappings":"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"}