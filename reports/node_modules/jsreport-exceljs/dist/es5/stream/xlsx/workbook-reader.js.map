{"version":3,"file":"workbook-reader.js","names":["fs","require","EventEmitter","Stream","unzip","Sax","tmp","FlowControl","StyleManager","WorkbookPropertiesManager","WorksheetReader","HyperlinkReader","setGracefulCleanup","WorkbookReader","options","styles","init","properties","worksheetReaders","hyperlinkReaders","readers","atEnd","waitingWorkSheets","tempFileCleanupCallbacks","input","Readable","createReadStream","Error","_flowControl","stream","_getStream","zip","Parse","on","entry","match","sheetNo","path","autodrain","_parseWorkbook","_parseSharedStrings","_parseStyles","sharedStrings","_parseWorksheet","file","err","fd","cleanupCallback","tempStream","createWriteStream","push","pipe","_parseHyperlinks","length","currentBook","processBooks","worksheetInfo","worksheet","forEach","cb","emit","setImmediate","payload","entries","_emitEntry","type","parseStream","parser","createStream","inT","t","index","node","name","text","error","Type","collection","reader","id","worksheetReader","_getReader","worksheets","read","hyperlinksReader","hyperlinks","Options","module","exports"],"sources":["../../../../lib/stream/xlsx/workbook-reader.js"],"sourcesContent":["const fs = require('fs');\nconst {EventEmitter} = require('events');\nconst Stream = require('stream');\nconst unzip = require('unzipper');\nconst Sax = require('sax');\nconst tmp = require('tmp');\n\nconst FlowControl = require('../../utils/flow-control');\n\nconst StyleManager = require('../../xlsx/xform/style/styles-xform');\nconst WorkbookPropertiesManager = require('../../xlsx/xform/book/workbook-properties-xform');\n\nconst WorksheetReader = require('./worksheet-reader');\nconst HyperlinkReader = require('./hyperlink-reader');\n\ntmp.setGracefulCleanup();\n\nclass WorkbookReader extends EventEmitter {\n  constructor(options) {\n    super();\n\n    this.options = options = options || {};\n\n    this.styles = new StyleManager();\n    this.styles.init();\n\n    this.properties = new WorkbookPropertiesManager();\n\n    // worksheet readers, indexed by sheetNo\n    this.worksheetReaders = {};\n\n    // hyperlink readers, indexed by sheetNo\n    this.hyperlinkReaders = {};\n\n    // count the open readers\n    this.readers = 0;\n\n    // end of stream check\n    this.atEnd = false;\n\n    // worksheets, deferred for parsing after shared strings reading\n    this.waitingWorkSheets = [];\n\n    // callbacks for temp files cleanup\n    this.tempFileCleanupCallbacks = [];\n  }\n\n  _getStream(input) {\n    if (input instanceof Stream.Readable) {\n      return input;\n    }\n    if (typeof input === 'string') {\n      return fs.createReadStream(input);\n    }\n    throw new Error('Could not recognise input');\n  }\n\n  get flowControl() {\n    if (!this._flowControl) {\n      this._flowControl = new FlowControl(this.options);\n    }\n    return this._flowControl;\n  }\n\n  read(input, options) {\n    const stream = (this.stream = this._getStream(input));\n    const zip = (this.zip = unzip.Parse());\n\n    zip.on('entry', entry => {\n      let match;\n      let sheetNo;\n      switch (entry.path) {\n        case '_rels/.rels':\n        case 'xl/_rels/workbook.xml.rels':\n          entry.autodrain();\n          break;\n        case 'xl/workbook.xml':\n          this._parseWorkbook(entry, options);\n          break;\n        case 'xl/sharedStrings.xml':\n          this._parseSharedStrings(entry, options);\n          break;\n        case 'xl/styles.xml':\n          this._parseStyles(entry, options);\n          break;\n        default:\n          if (entry.path.match(/xl\\/worksheets\\/sheet\\d+[.]xml/)) {\n            match = entry.path.match(/xl\\/worksheets\\/sheet(\\d+)[.]xml/);\n            sheetNo = match[1];\n            if (this.sharedStrings) {\n              this._parseWorksheet(entry, sheetNo, options);\n            } else {\n              // create temp file for each worksheet\n              tmp.file((err, path, fd, cleanupCallback) => {\n                if (err) throw err;\n\n                const tempStream = fs.createWriteStream(path);\n\n                this.waitingWorkSheets.push({sheetNo, options, path});\n                entry.pipe(tempStream);\n\n                this.tempFileCleanupCallbacks.push(cleanupCallback);\n              });\n            }\n          } else if (entry.path.match(/xl\\/worksheets\\/_rels\\/sheet\\d+[.]xml.rels/)) {\n            match = entry.path.match(/xl\\/worksheets\\/_rels\\/sheet(\\d+)[.]xml.rels/);\n            sheetNo = match[1];\n            this._parseHyperlinks(entry, sheetNo, options);\n          } else {\n            entry.autodrain();\n          }\n          break;\n      }\n    });\n\n    zip.on('close', () => {\n      if (this.waitingWorkSheets.length) {\n        let currentBook = 0;\n\n        const processBooks = () => {\n          const worksheetInfo = this.waitingWorkSheets[currentBook];\n          const entry = fs.createReadStream(worksheetInfo.path);\n\n          const {sheetNo} = worksheetInfo;\n          const worksheet = this._parseWorksheet(\n            entry,\n            sheetNo,\n            worksheetInfo.options\n          );\n\n          worksheet.on('finished', () => {\n            ++currentBook;\n            if (currentBook === this.waitingWorkSheets.length) {\n              // temp files cleaning up\n              this.tempFileCleanupCallbacks.forEach(cb => {\n                cb();\n              });\n\n              this.tempFileCleanupCallbacks = [];\n\n              this.emit('end');\n              this.atEnd = true;\n              if (!this.readers) {\n                this.emit('finished');\n              }\n            } else {\n              setImmediate(processBooks);\n            }\n          });\n        };\n        setImmediate(processBooks);\n      } else {\n        this.emit('end');\n        this.atEnd = true;\n        if (!this.readers) {\n          this.emit('finished');\n        }\n      }\n    });\n\n    zip.on('error', err => {\n      this.emit('error', err);\n    });\n\n    // Pipe stream into top flow-control\n    // this.flowControl.pipe(zip);\n    stream.pipe(zip);\n  }\n\n  _emitEntry(options, payload) {\n    if (options.entries === 'emit') {\n      this.emit('entry', payload);\n    }\n  }\n\n  _parseWorkbook(entry, options) {\n    this._emitEntry(options, {type: 'workbook'});\n    this.properties.parseStream(entry);\n  }\n\n  _parseSharedStrings(entry, options) {\n    this._emitEntry(options, {type: 'shared-strings'});\n    let sharedStrings = null;\n    switch (options.sharedStrings) {\n      case 'cache':\n        sharedStrings = this.sharedStrings = [];\n        break;\n      case 'emit':\n        break;\n      default:\n        entry.autodrain();\n        return;\n    }\n\n    const parser = Sax.createStream(true, {});\n    let inT = false;\n    let t = null;\n    let index = 0;\n    parser.on('opentag', node => {\n      if (node.name === 't') {\n        t = null;\n        inT = true;\n      }\n    });\n    parser.on('closetag', name => {\n      if (inT && name === 't') {\n        if (sharedStrings) {\n          sharedStrings.push(t);\n        } else {\n          this.emit('shared-string', {index: index++, text: t});\n        }\n        t = null;\n      }\n    });\n    parser.on('text', text => {\n      t = t ? t + text : text;\n    });\n    parser.on('error', error => {\n      this.emit('error', error);\n    });\n    entry.pipe(parser);\n  }\n\n  _parseStyles(entry, options) {\n    this._emitEntry(options, {type: 'styles'});\n    if (options.styles !== 'cache') {\n      entry.autodrain();\n      return;\n    }\n    this.styles = new StyleManager();\n    this.styles.parseStream(entry);\n  }\n\n  _getReader(Type, collection, sheetNo) {\n    let reader = collection[sheetNo];\n    if (!reader) {\n      reader = new Type(this, sheetNo);\n      this.readers++;\n      reader.on('finished', () => {\n        if (!--this.readers) {\n          if (this.atEnd) {\n            this.emit('finished');\n          }\n        }\n      });\n      collection[sheetNo] = reader;\n    }\n    return reader;\n  }\n\n  _parseWorksheet(entry, sheetNo, options) {\n    this._emitEntry(options, {type: 'worksheet', id: sheetNo});\n    const worksheetReader = this._getReader(WorksheetReader, this.worksheetReaders, sheetNo);\n    if (options.worksheets === 'emit') {\n      this.emit('worksheet', worksheetReader);\n    }\n    worksheetReader.read(entry, options, this.hyperlinkReaders[sheetNo]);\n    return worksheetReader;\n  }\n\n  _parseHyperlinks(entry, sheetNo, options) {\n    this._emitEntry(options, {type: 'hyerlinks', id: sheetNo});\n    const hyperlinksReader = this._getReader(HyperlinkReader, this.hyperlinkReaders, sheetNo);\n    if (options.hyperlinks === 'emit') {\n      this.emit('hyperlinks', hyperlinksReader);\n    }\n    hyperlinksReader.read(entry, options);\n  }\n}\n\n// for reference - these are the valid values for options\nWorkbookReader.Options = {\n  entries: ['emit'],\n  sharedStrings: ['cache', 'emit'],\n  styles: ['cache'],\n  hyperlinks: ['cache', 'emit'],\n  worksheets: ['emit'],\n};\n\n\nmodule.exports = WorkbookReader;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAlB;;AACA,eAAuBA,OAAO,CAAC,QAAD,CAA9B;AAAA,IAAOC,YAAP,YAAOA,YAAP;;AACA,IAAMC,MAAM,GAAGF,OAAO,CAAC,QAAD,CAAtB;;AACA,IAAMG,KAAK,GAAGH,OAAO,CAAC,UAAD,CAArB;;AACA,IAAMI,GAAG,GAAGJ,OAAO,CAAC,KAAD,CAAnB;;AACA,IAAMK,GAAG,GAAGL,OAAO,CAAC,KAAD,CAAnB;;AAEA,IAAMM,WAAW,GAAGN,OAAO,CAAC,0BAAD,CAA3B;;AAEA,IAAMO,YAAY,GAAGP,OAAO,CAAC,qCAAD,CAA5B;;AACA,IAAMQ,yBAAyB,GAAGR,OAAO,CAAC,iDAAD,CAAzC;;AAEA,IAAMS,eAAe,GAAGT,OAAO,CAAC,oBAAD,CAA/B;;AACA,IAAMU,eAAe,GAAGV,OAAO,CAAC,oBAAD,CAA/B;;AAEAK,GAAG,CAACM,kBAAJ;;IAEMC,c;;;;;EACJ,wBAAYC,OAAZ,EAAqB;IAAA;;IAAA;;IACnB;IAEA,MAAKA,OAAL,GAAeA,OAAO,GAAGA,OAAO,IAAI,EAApC;IAEA,MAAKC,MAAL,GAAc,IAAIP,YAAJ,EAAd;;IACA,MAAKO,MAAL,CAAYC,IAAZ;;IAEA,MAAKC,UAAL,GAAkB,IAAIR,yBAAJ,EAAlB,CARmB,CAUnB;;IACA,MAAKS,gBAAL,GAAwB,EAAxB,CAXmB,CAanB;;IACA,MAAKC,gBAAL,GAAwB,EAAxB,CAdmB,CAgBnB;;IACA,MAAKC,OAAL,GAAe,CAAf,CAjBmB,CAmBnB;;IACA,MAAKC,KAAL,GAAa,KAAb,CApBmB,CAsBnB;;IACA,MAAKC,iBAAL,GAAyB,EAAzB,CAvBmB,CAyBnB;;IACA,MAAKC,wBAAL,GAAgC,EAAhC;IA1BmB;EA2BpB;;;;WAED,oBAAWC,KAAX,EAAkB;MAChB,IAAIA,KAAK,YAAYrB,MAAM,CAACsB,QAA5B,EAAsC;QACpC,OAAOD,KAAP;MACD;;MACD,IAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;QAC7B,OAAOxB,EAAE,CAAC0B,gBAAH,CAAoBF,KAApB,CAAP;MACD;;MACD,MAAM,IAAIG,KAAJ,CAAU,2BAAV,CAAN;IACD;;;SAED,eAAkB;MAChB,IAAI,CAAC,KAAKC,YAAV,EAAwB;QACtB,KAAKA,YAAL,GAAoB,IAAIrB,WAAJ,CAAgB,KAAKO,OAArB,CAApB;MACD;;MACD,OAAO,KAAKc,YAAZ;IACD;;;WAED,cAAKJ,KAAL,EAAYV,OAAZ,EAAqB;MAAA;;MACnB,IAAMe,MAAM,GAAI,KAAKA,MAAL,GAAc,KAAKC,UAAL,CAAgBN,KAAhB,CAA9B;;MACA,IAAMO,GAAG,GAAI,KAAKA,GAAL,GAAW3B,KAAK,CAAC4B,KAAN,EAAxB;MAEAD,GAAG,CAACE,EAAJ,CAAO,OAAP,EAAgB,UAAAC,KAAK,EAAI;QACvB,IAAIC,KAAJ;QACA,IAAIC,OAAJ;;QACA,QAAQF,KAAK,CAACG,IAAd;UACE,KAAK,aAAL;UACA,KAAK,4BAAL;YACEH,KAAK,CAACI,SAAN;YACA;;UACF,KAAK,iBAAL;YACE,MAAI,CAACC,cAAL,CAAoBL,KAApB,EAA2BpB,OAA3B;;YACA;;UACF,KAAK,sBAAL;YACE,MAAI,CAAC0B,mBAAL,CAAyBN,KAAzB,EAAgCpB,OAAhC;;YACA;;UACF,KAAK,eAAL;YACE,MAAI,CAAC2B,YAAL,CAAkBP,KAAlB,EAAyBpB,OAAzB;;YACA;;UACF;YACE,IAAIoB,KAAK,CAACG,IAAN,CAAWF,KAAX,CAAiB,gCAAjB,CAAJ,EAAwD;cACtDA,KAAK,GAAGD,KAAK,CAACG,IAAN,CAAWF,KAAX,CAAiB,kCAAjB,CAAR;cACAC,OAAO,GAAGD,KAAK,CAAC,CAAD,CAAf;;cACA,IAAI,MAAI,CAACO,aAAT,EAAwB;gBACtB,MAAI,CAACC,eAAL,CAAqBT,KAArB,EAA4BE,OAA5B,EAAqCtB,OAArC;cACD,CAFD,MAEO;gBACL;gBACAR,GAAG,CAACsC,IAAJ,CAAS,UAACC,GAAD,EAAMR,IAAN,EAAYS,EAAZ,EAAgBC,eAAhB,EAAoC;kBAC3C,IAAIF,GAAJ,EAAS,MAAMA,GAAN;kBAET,IAAMG,UAAU,GAAGhD,EAAE,CAACiD,iBAAH,CAAqBZ,IAArB,CAAnB;;kBAEA,MAAI,CAACf,iBAAL,CAAuB4B,IAAvB,CAA4B;oBAACd,OAAO,EAAPA,OAAD;oBAAUtB,OAAO,EAAPA,OAAV;oBAAmBuB,IAAI,EAAJA;kBAAnB,CAA5B;;kBACAH,KAAK,CAACiB,IAAN,CAAWH,UAAX;;kBAEA,MAAI,CAACzB,wBAAL,CAA8B2B,IAA9B,CAAmCH,eAAnC;gBACD,CATD;cAUD;YACF,CAlBD,MAkBO,IAAIb,KAAK,CAACG,IAAN,CAAWF,KAAX,CAAiB,4CAAjB,CAAJ,EAAoE;cACzEA,KAAK,GAAGD,KAAK,CAACG,IAAN,CAAWF,KAAX,CAAiB,8CAAjB,CAAR;cACAC,OAAO,GAAGD,KAAK,CAAC,CAAD,CAAf;;cACA,MAAI,CAACiB,gBAAL,CAAsBlB,KAAtB,EAA6BE,OAA7B,EAAsCtB,OAAtC;YACD,CAJM,MAIA;cACLoB,KAAK,CAACI,SAAN;YACD;;YACD;QAxCJ;MA0CD,CA7CD;MA+CAP,GAAG,CAACE,EAAJ,CAAO,OAAP,EAAgB,YAAM;QACpB,IAAI,MAAI,CAACX,iBAAL,CAAuB+B,MAA3B,EAAmC;UACjC,IAAIC,WAAW,GAAG,CAAlB;;UAEA,IAAMC,YAAY,GAAG,SAAfA,YAAe,GAAM;YACzB,IAAMC,aAAa,GAAG,MAAI,CAAClC,iBAAL,CAAuBgC,WAAvB,CAAtB;YACA,IAAMpB,KAAK,GAAGlC,EAAE,CAAC0B,gBAAH,CAAoB8B,aAAa,CAACnB,IAAlC,CAAd;YAEA,IAAOD,OAAP,GAAkBoB,aAAlB,CAAOpB,OAAP;;YACA,IAAMqB,SAAS,GAAG,MAAI,CAACd,eAAL,CAChBT,KADgB,EAEhBE,OAFgB,EAGhBoB,aAAa,CAAC1C,OAHE,CAAlB;;YAMA2C,SAAS,CAACxB,EAAV,CAAa,UAAb,EAAyB,YAAM;cAC7B,EAAEqB,WAAF;;cACA,IAAIA,WAAW,KAAK,MAAI,CAAChC,iBAAL,CAAuB+B,MAA3C,EAAmD;gBACjD;gBACA,MAAI,CAAC9B,wBAAL,CAA8BmC,OAA9B,CAAsC,UAAAC,EAAE,EAAI;kBAC1CA,EAAE;gBACH,CAFD;;gBAIA,MAAI,CAACpC,wBAAL,GAAgC,EAAhC;;gBAEA,MAAI,CAACqC,IAAL,CAAU,KAAV;;gBACA,MAAI,CAACvC,KAAL,GAAa,IAAb;;gBACA,IAAI,CAAC,MAAI,CAACD,OAAV,EAAmB;kBACjB,MAAI,CAACwC,IAAL,CAAU,UAAV;gBACD;cACF,CAbD,MAaO;gBACLC,YAAY,CAACN,YAAD,CAAZ;cACD;YACF,CAlBD;UAmBD,CA9BD;;UA+BAM,YAAY,CAACN,YAAD,CAAZ;QACD,CAnCD,MAmCO;UACL,MAAI,CAACK,IAAL,CAAU,KAAV;;UACA,MAAI,CAACvC,KAAL,GAAa,IAAb;;UACA,IAAI,CAAC,MAAI,CAACD,OAAV,EAAmB;YACjB,MAAI,CAACwC,IAAL,CAAU,UAAV;UACD;QACF;MACF,CA3CD;MA6CA7B,GAAG,CAACE,EAAJ,CAAO,OAAP,EAAgB,UAAAY,GAAG,EAAI;QACrB,MAAI,CAACe,IAAL,CAAU,OAAV,EAAmBf,GAAnB;MACD,CAFD,EAhGmB,CAoGnB;MACA;;MACAhB,MAAM,CAACsB,IAAP,CAAYpB,GAAZ;IACD;;;WAED,oBAAWjB,OAAX,EAAoBgD,OAApB,EAA6B;MAC3B,IAAIhD,OAAO,CAACiD,OAAR,KAAoB,MAAxB,EAAgC;QAC9B,KAAKH,IAAL,CAAU,OAAV,EAAmBE,OAAnB;MACD;IACF;;;WAED,wBAAe5B,KAAf,EAAsBpB,OAAtB,EAA+B;MAC7B,KAAKkD,UAAL,CAAgBlD,OAAhB,EAAyB;QAACmD,IAAI,EAAE;MAAP,CAAzB;;MACA,KAAKhD,UAAL,CAAgBiD,WAAhB,CAA4BhC,KAA5B;IACD;;;WAED,6BAAoBA,KAApB,EAA2BpB,OAA3B,EAAoC;MAAA;;MAClC,KAAKkD,UAAL,CAAgBlD,OAAhB,EAAyB;QAACmD,IAAI,EAAE;MAAP,CAAzB;;MACA,IAAIvB,aAAa,GAAG,IAApB;;MACA,QAAQ5B,OAAO,CAAC4B,aAAhB;QACE,KAAK,OAAL;UACEA,aAAa,GAAG,KAAKA,aAAL,GAAqB,EAArC;UACA;;QACF,KAAK,MAAL;UACE;;QACF;UACER,KAAK,CAACI,SAAN;UACA;MARJ;;MAWA,IAAM6B,MAAM,GAAG9D,GAAG,CAAC+D,YAAJ,CAAiB,IAAjB,EAAuB,EAAvB,CAAf;MACA,IAAIC,GAAG,GAAG,KAAV;MACA,IAAIC,CAAC,GAAG,IAAR;MACA,IAAIC,KAAK,GAAG,CAAZ;MACAJ,MAAM,CAAClC,EAAP,CAAU,SAAV,EAAqB,UAAAuC,IAAI,EAAI;QAC3B,IAAIA,IAAI,CAACC,IAAL,KAAc,GAAlB,EAAuB;UACrBH,CAAC,GAAG,IAAJ;UACAD,GAAG,GAAG,IAAN;QACD;MACF,CALD;MAMAF,MAAM,CAAClC,EAAP,CAAU,UAAV,EAAsB,UAAAwC,IAAI,EAAI;QAC5B,IAAIJ,GAAG,IAAII,IAAI,KAAK,GAApB,EAAyB;UACvB,IAAI/B,aAAJ,EAAmB;YACjBA,aAAa,CAACQ,IAAd,CAAmBoB,CAAnB;UACD,CAFD,MAEO;YACL,MAAI,CAACV,IAAL,CAAU,eAAV,EAA2B;cAACW,KAAK,EAAEA,KAAK,EAAb;cAAiBG,IAAI,EAAEJ;YAAvB,CAA3B;UACD;;UACDA,CAAC,GAAG,IAAJ;QACD;MACF,CATD;MAUAH,MAAM,CAAClC,EAAP,CAAU,MAAV,EAAkB,UAAAyC,IAAI,EAAI;QACxBJ,CAAC,GAAGA,CAAC,GAAGA,CAAC,GAAGI,IAAP,GAAcA,IAAnB;MACD,CAFD;MAGAP,MAAM,CAAClC,EAAP,CAAU,OAAV,EAAmB,UAAA0C,KAAK,EAAI;QAC1B,MAAI,CAACf,IAAL,CAAU,OAAV,EAAmBe,KAAnB;MACD,CAFD;MAGAzC,KAAK,CAACiB,IAAN,CAAWgB,MAAX;IACD;;;WAED,sBAAajC,KAAb,EAAoBpB,OAApB,EAA6B;MAC3B,KAAKkD,UAAL,CAAgBlD,OAAhB,EAAyB;QAACmD,IAAI,EAAE;MAAP,CAAzB;;MACA,IAAInD,OAAO,CAACC,MAAR,KAAmB,OAAvB,EAAgC;QAC9BmB,KAAK,CAACI,SAAN;QACA;MACD;;MACD,KAAKvB,MAAL,GAAc,IAAIP,YAAJ,EAAd;MACA,KAAKO,MAAL,CAAYmD,WAAZ,CAAwBhC,KAAxB;IACD;;;WAED,oBAAW0C,IAAX,EAAiBC,UAAjB,EAA6BzC,OAA7B,EAAsC;MAAA;;MACpC,IAAI0C,MAAM,GAAGD,UAAU,CAACzC,OAAD,CAAvB;;MACA,IAAI,CAAC0C,MAAL,EAAa;QACXA,MAAM,GAAG,IAAIF,IAAJ,CAAS,IAAT,EAAexC,OAAf,CAAT;QACA,KAAKhB,OAAL;QACA0D,MAAM,CAAC7C,EAAP,CAAU,UAAV,EAAsB,YAAM;UAC1B,IAAI,CAAC,GAAE,MAAI,CAACb,OAAZ,EAAqB;YACnB,IAAI,MAAI,CAACC,KAAT,EAAgB;cACd,MAAI,CAACuC,IAAL,CAAU,UAAV;YACD;UACF;QACF,CAND;QAOAiB,UAAU,CAACzC,OAAD,CAAV,GAAsB0C,MAAtB;MACD;;MACD,OAAOA,MAAP;IACD;;;WAED,yBAAgB5C,KAAhB,EAAuBE,OAAvB,EAAgCtB,OAAhC,EAAyC;MACvC,KAAKkD,UAAL,CAAgBlD,OAAhB,EAAyB;QAACmD,IAAI,EAAE,WAAP;QAAoBc,EAAE,EAAE3C;MAAxB,CAAzB;;MACA,IAAM4C,eAAe,GAAG,KAAKC,UAAL,CAAgBvE,eAAhB,EAAiC,KAAKQ,gBAAtC,EAAwDkB,OAAxD,CAAxB;;MACA,IAAItB,OAAO,CAACoE,UAAR,KAAuB,MAA3B,EAAmC;QACjC,KAAKtB,IAAL,CAAU,WAAV,EAAuBoB,eAAvB;MACD;;MACDA,eAAe,CAACG,IAAhB,CAAqBjD,KAArB,EAA4BpB,OAA5B,EAAqC,KAAKK,gBAAL,CAAsBiB,OAAtB,CAArC;MACA,OAAO4C,eAAP;IACD;;;WAED,0BAAiB9C,KAAjB,EAAwBE,OAAxB,EAAiCtB,OAAjC,EAA0C;MACxC,KAAKkD,UAAL,CAAgBlD,OAAhB,EAAyB;QAACmD,IAAI,EAAE,WAAP;QAAoBc,EAAE,EAAE3C;MAAxB,CAAzB;;MACA,IAAMgD,gBAAgB,GAAG,KAAKH,UAAL,CAAgBtE,eAAhB,EAAiC,KAAKQ,gBAAtC,EAAwDiB,OAAxD,CAAzB;;MACA,IAAItB,OAAO,CAACuE,UAAR,KAAuB,MAA3B,EAAmC;QACjC,KAAKzB,IAAL,CAAU,YAAV,EAAwBwB,gBAAxB;MACD;;MACDA,gBAAgB,CAACD,IAAjB,CAAsBjD,KAAtB,EAA6BpB,OAA7B;IACD;;;;EA1P0BZ,Y,GA6P7B;;;AACAW,cAAc,CAACyE,OAAf,GAAyB;EACvBvB,OAAO,EAAE,CAAC,MAAD,CADc;EAEvBrB,aAAa,EAAE,CAAC,OAAD,EAAU,MAAV,CAFQ;EAGvB3B,MAAM,EAAE,CAAC,OAAD,CAHe;EAIvBsE,UAAU,EAAE,CAAC,OAAD,EAAU,MAAV,CAJW;EAKvBH,UAAU,EAAE,CAAC,MAAD;AALW,CAAzB;AASAK,MAAM,CAACC,OAAP,GAAiB3E,cAAjB"}