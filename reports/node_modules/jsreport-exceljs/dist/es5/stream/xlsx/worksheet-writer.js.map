{"version":3,"file":"worksheet-writer.js","names":["_","require","RelType","colCache","Dimensions","StringBuf","Row","Column","SheetRelsWriter","SheetCommentsWriter","DataValidations","xmlBuffer","ListXform","DataValidationsXform","SheetPropertiesXform","SheetFormatPropertiesXform","ColXform","RowXform","HyperlinkXform","SheetViewXform","SheetProtectionXform","PageMarginsXform","PageSetupXform","AutoFilterXform","PictureXform","xform","dataValidations","sheetProperties","sheetFormatProperties","columns","tag","length","childXform","row","hyperlinks","sheetViews","sheetProtection","pageMargins","pageSeteup","autoFilter","picture","WorksheetWriter","options","id","name","state","_rows","_columns","_keys","_merges","_calcCells","add","_sheetRelsWriter","_sheetCommentsWriter","_dimensions","_rowZero","committed","_formulae","_siFormulae","properties","Object","assign","defaultRowHeight","dyDescent","outlineLevelCol","outlineLevelRow","pageSetup","margins","left","right","top","bottom","header","footer","orientation","horizontalDpi","verticalDpi","fitToPage","fitToWidth","fitToHeight","scale","pageOrder","blackAndWhite","draft","cellComments","errors","paperSize","undefined","showRowColHeaders","showGridLines","horizontalCentered","verticalCentered","rowBreaks","colBreaks","useSharedStrings","_workbook","workbook","hasComments","_views","views","_media","_writeOpenWorksheet","startedData","_stream","_openStream","pause","Error","forEach","cRow","_writeRow","rawColsXML","_writeColumns","_writeOpenSheetData","_writeCloseSheetData","_writeAutoFilter","_writeMergeCells","_writeHyperlinks","_writeDataValidations","_writeSheetProtection","_writePageMargins","_writePageSetup","_writeBackground","_writeLegacyData","_writeCloseWorksheet","stream","end","commit","value","_headerRowCount","reduce","pv","cv","headerCount","headers","Math","max","count","defn","column","push","key","f","each","c","col","l2n","n","iteratee","includeEmpty","_nextRow","i","getRow","hasValues","number","found","shift","rowNumber","index","values","r","address","getAddress","findRow","findCell","getCellEx","dimensions","Array","prototype","slice","call","arguments","merge","intersects","master","getCell","j","imageId","_background","text","reset","addText","write","xmlBuf","sheetPropertiesModel","outlineProperties","tabColor","toXml","sheetFormatPropertiesModel","defaultColWidth","_writeSheetProperties","_writeSheetFormatProperties","getXML","cols","toModel","prepare","styles","_write","height","model","cellStylesCache","_cellStylesCache","sharedStrings","hyperlinksProxy","merges","formulae","siFormulae","comments","cells","cell","formula","addComments","_hyperlinks","image","getImage","pictureId","addMedia","Target","Type","Image","rId","vmlRelId","module","exports"],"sources":["../../../../lib/stream/xlsx/worksheet-writer.js"],"sourcesContent":["const _ = require('../../utils/under-dash');\n\nconst RelType = require('../../xlsx/rel-type');\n\nconst colCache = require('../../utils/col-cache');\nconst Dimensions = require('../../doc/range');\nconst StringBuf = require('../../utils/string-buf');\n\nconst Row = require('../../doc/row');\nconst Column = require('../../doc/column');\n\nconst SheetRelsWriter = require('./sheet-rels-writer');\nconst SheetCommentsWriter = require('./sheet-comments-writer');\nconst DataValidations = require('../../doc/data-validations');\n\nconst xmlBuffer = new StringBuf();\n\n// ============================================================================================\n// Xforms\nconst ListXform = require('../../xlsx/xform/list-xform');\nconst DataValidationsXform = require('../../xlsx/xform/sheet/data-validations-xform');\nconst SheetPropertiesXform = require('../../xlsx/xform/sheet/sheet-properties-xform');\nconst SheetFormatPropertiesXform = require('../../xlsx/xform/sheet/sheet-format-properties-xform');\nconst ColXform = require('../../xlsx/xform/sheet/col-xform');\nconst RowXform = require('../../xlsx/xform/sheet/row-xform');\nconst HyperlinkXform = require('../../xlsx/xform/sheet/hyperlink-xform');\nconst SheetViewXform = require('../../xlsx/xform/sheet/sheet-view-xform');\nconst SheetProtectionXform = require('../../xlsx/xform/sheet/sheet-protection-xform');\nconst PageMarginsXform = require('../../xlsx/xform/sheet/page-margins-xform');\nconst PageSetupXform = require('../../xlsx/xform/sheet/page-setup-xform');\nconst AutoFilterXform = require('../../xlsx/xform/sheet/auto-filter-xform');\nconst PictureXform = require('../../xlsx/xform/sheet/picture-xform');\n\n// since prepare and render are functional, we can use singletons\nconst xform = {\n  dataValidations: new DataValidationsXform(),\n  sheetProperties: new SheetPropertiesXform(),\n  sheetFormatProperties: new SheetFormatPropertiesXform(),\n  columns: new ListXform({tag: 'cols', length: false, childXform: new ColXform()}),\n  row: new RowXform(),\n  hyperlinks: new ListXform({tag: 'hyperlinks', length: false, childXform: new HyperlinkXform()}),\n  sheetViews: new ListXform({tag: 'sheetViews', length: false, childXform: new SheetViewXform()}),\n  sheetProtection: new SheetProtectionXform(),\n  pageMargins: new PageMarginsXform(),\n  pageSeteup: new PageSetupXform(),\n  autoFilter: new AutoFilterXform(),\n  picture: new PictureXform(),\n};\n\n// ============================================================================================\n\nclass WorksheetWriter {\n  constructor(options) {\n    // in a workbook, each sheet will have a number\n    this.id = options.id;\n\n    // and a name\n    this.name = options.name || `Sheet${this.id}`;\n\n    // add a state\n    this.state = options.state || 'visible';\n\n    // rows are stored here while they need to be worked on.\n    // when they are committed, they will be deleted.\n    this._rows = [];\n\n    // column definitions\n    this._columns = null;\n\n    // column keys (addRow convenience): key ==> this._columns index\n    this._keys = {};\n\n    // keep record of all merges\n    this._merges = [];\n\n    // keep record of all formulas\n    this._calcCells = {};\n\n    this._merges.add = function() {\n    }; // ignore cell instruction\n\n    // keep record of all hyperlinks\n    this._sheetRelsWriter = new SheetRelsWriter(options);\n\n    this._sheetCommentsWriter = new SheetCommentsWriter(this, this._sheetRelsWriter, options);\n\n\n    // keep a record of dimensions\n    this._dimensions = new Dimensions();\n\n    // first uncommitted row\n    this._rowZero = 1;\n\n    // committed flag\n    this.committed = false;\n\n    // for data validations\n    this.dataValidations = new DataValidations();\n\n    // for sharing formulae\n    this._formulae = {};\n    this._siFormulae = 0;\n\n    // for default row height, outline levels, etc\n    this.properties = Object.assign(\n      {},\n      {\n        defaultRowHeight: 15,\n        dyDescent: 55,\n        outlineLevelCol: 0,\n        outlineLevelRow: 0,\n      },\n      options.properties\n    );\n\n    // for all things printing\n    this.pageSetup = Object.assign(\n      {},\n      {\n        margins: {left: 0.7, right: 0.7, top: 0.75, bottom: 0.75, header: 0.3, footer: 0.3},\n        orientation: 'portrait',\n        horizontalDpi: 4294967295,\n        verticalDpi: 4294967295,\n        fitToPage: !!(options.pageSetup && ((options.pageSetup.fitToWidth || options.pageSetup.fitToHeight) && !options.pageSetup.scale)),\n        pageOrder: 'downThenOver',\n        blackAndWhite: false,\n        draft: false,\n        cellComments: 'None',\n        errors: 'displayed',\n        scale: 100,\n        fitToWidth: 1,\n        fitToHeight: 1,\n        paperSize: undefined,\n        showRowColHeaders: false,\n        showGridLines: false,\n        horizontalCentered: false,\n        verticalCentered: false,\n        rowBreaks: null,\n        colBreaks: null,\n      },\n      options.pageSetup\n    );\n\n    // using shared strings creates a smaller xlsx file but may use more memory\n    this.useSharedStrings = options.useSharedStrings || false;\n\n    this._workbook = options.workbook;\n\n    this.hasComments = false;\n\n    // views\n    this._views = options.views || [];\n\n    // auto filter\n    this.autoFilter = options.autoFilter || null;\n\n    this._media = [];\n\n    // start writing to stream now\n    this._writeOpenWorksheet();\n\n    this.startedData = false;\n  }\n\n  get workbook() {\n    return this._workbook;\n  }\n\n  get stream() {\n    if (!this._stream) {\n      // eslint-disable-next-line no-underscore-dangle\n      this._stream = this._workbook._openStream(`/xl/worksheets/sheet${this.id}.xml`, this.id);\n\n      // pause stream to prevent 'data' events\n      this._stream.pause();\n    }\n    return this._stream;\n  }\n\n  // destroy - not a valid operation for a streaming writer\n  // even though some streamers might be able to, it's a bad idea.\n  destroy() {\n    throw new Error('Invalid Operation: destroy');\n  }\n\n  commit() {\n    if (this.committed) {\n      return;\n    }\n    // commit all rows\n    this._rows.forEach(cRow => {\n      if (cRow) {\n        // write the row to the stream\n        this._writeRow(cRow);\n      }\n    });\n\n    this.rawColsXML = this._writeColumns(true);\n\n    // we _cannot_ accept new rows from now on\n    this._rows = null;\n\n\n    if (!this.startedData) {\n      this._writeOpenSheetData();\n    }\n    this._writeCloseSheetData();\n    this._writeAutoFilter();\n    this._writeMergeCells();\n\n    // for some reason, Excel can't handle dimensions at the bottom of the file\n    // this._writeDimensions();\n\n    this._writeHyperlinks();\n    this._writeDataValidations();\n    this._writeSheetProtection();\n    this._writePageMargins();\n    this._writePageSetup();\n    this._writeBackground();\n\n    // Legacy Data tag for comments\n    this._writeLegacyData();\n\n    this._writeCloseWorksheet();\n    // signal end of stream to workbook\n    this.stream.end();\n\n    this._sheetCommentsWriter.commit();\n    // also commit the hyperlinks if any\n    this._sheetRelsWriter.commit();\n\n    this.committed = true;\n  }\n\n  // return the current dimensions of the writer\n  get dimensions() {\n    return this._dimensions;\n  }\n\n  get views() {\n    return this._views;\n  }\n\n  // =========================================================================\n  // Columns\n\n  // get the current columns array.\n  get columns() {\n    return this._columns;\n  }\n\n  // set the columns from an array of column definitions.\n  // Note: any headers defined will overwrite existing values.\n  set columns(value) {\n    // calculate max header row count\n    this._headerRowCount = value.reduce((pv, cv) => {\n      const headerCount = (cv.header && 1) || (cv.headers && cv.headers.length) || 0;\n      return Math.max(pv, headerCount);\n    }, 0);\n\n    // construct Column objects\n    let count = 1;\n    const columns = (this._columns = []);\n    value.forEach(defn => {\n      const column = new Column(this, count++, false);\n      columns.push(column);\n      column.defn = defn;\n    });\n  }\n\n  getColumnKey(key) {\n    return this._keys[key];\n  }\n\n  setColumnKey(key, value) {\n    this._keys[key] = value;\n  }\n\n  deleteColumnKey(key) {\n    delete this._keys[key];\n  }\n\n  eachColumnKey(f) {\n    _.each(this._keys, f);\n  }\n\n\n  // get a single column by col number. If it doesn't exist, it and any gaps before it\n  // are created.\n  getColumn(c) {\n    if (typeof c === 'string') {\n      // if it matches a key'd column, return that\n      const col = this._keys[c];\n      if (col) return col;\n\n      // otherwise, assume letter\n      c = colCache.l2n(c);\n    }\n    if (!this._columns) {\n      this._columns = [];\n    }\n    if (c > this._columns.length) {\n      let n = this._columns.length + 1;\n      while (n <= c) {\n        this._columns.push(new Column(this, n++));\n      }\n    }\n    return this._columns[c - 1];\n  }\n\n  // =========================================================================\n  // Rows\n  get _nextRow() {\n    return this._rowZero + this._rows.length;\n  }\n\n  // iterate over every uncommitted row in the worksheet, including maybe empty rows\n  eachRow(options, iteratee) {\n    if (!iteratee) {\n      iteratee = options;\n      options = undefined;\n    }\n    if (options && options.includeEmpty) {\n      const n = this._nextRow;\n      for (let i = this._rowZero; i < n; i++) {\n        iteratee(this.getRow(i), i);\n      }\n    } else {\n      this._rows.forEach(row => {\n        if (row.hasValues) {\n          iteratee(row, row.number);\n        }\n      });\n    }\n  }\n\n  _commitRow(cRow) {\n    // since rows must be written in order, we commit all rows up till and including cRow\n    let found = false;\n    while (this._rows.length && !found) {\n      const row = this._rows.shift();\n      this._rowZero++;\n      if (row) {\n        this._writeRow(row);\n        found = row.number === cRow.number;\n        this._rowZero = row.number + 1;\n      }\n    }\n  }\n\n  get lastRow() {\n    // returns last uncommitted row\n    if (this._rows.length) {\n      return this._rows[this._rows.length - 1];\n    }\n    return undefined;\n  }\n\n  // find a row (if exists) by row number\n  findRow(rowNumber) {\n    const index = rowNumber - this._rowZero;\n    return this._rows[index];\n  }\n\n  getRow(rowNumber) {\n    const index = rowNumber - this._rowZero;\n\n    // may fail if rows have been comitted\n    if (index < 0) {\n      throw new Error('Out of bounds: this row has been committed');\n    }\n    let row = this._rows[index];\n    if (!row) {\n      this._rows[index] = row = new Row(this, rowNumber);\n    }\n    return row;\n  }\n\n  addRow(value) {\n    const row = new Row(this, this._nextRow);\n    this._rows[row.number - this._rowZero] = row;\n    row.values = value;\n    return row;\n  }\n\n  // ================================================================================\n  // Cells\n\n  // returns the cell at [r,c] or address given by r. If not found, return undefined\n  findCell(r, c) {\n    const address = colCache.getAddress(r, c);\n    const row = this.findRow(address.row);\n    return row ? row.findCell(address.column) : undefined;\n  }\n\n  // return the cell at [r,c] or address given by r. If not found, create a new one.\n  getCell(r, c) {\n    const address = colCache.getAddress(r, c);\n    const row = this.getRow(address.row);\n    return row.getCellEx(address);\n  }\n\n  mergeCells() {\n    // may fail if rows have been comitted\n    const dimensions = new Dimensions(Array.prototype.slice.call(arguments, 0)); // convert arguments into Array\n\n    // check cells aren't already merged\n    this._merges.forEach(merge => {\n      if (merge.intersects(dimensions)) {\n        throw new Error('Cannot merge already merged cells');\n      }\n    });\n\n    // apply merge\n    const master = this.getCell(dimensions.top, dimensions.left);\n    for (let i = dimensions.top; i <= dimensions.bottom; i++) {\n      for (let j = dimensions.left; j <= dimensions.right; j++) {\n        if (i > dimensions.top || j > dimensions.left) {\n          this.getCell(i, j).merge(master);\n        }\n      }\n    }\n\n    // index merge\n    this._merges.push(dimensions);\n  }\n\n  // =========================================================================\n\n  addBackgroundImage(imageId) {\n    this._background = {\n      imageId,\n    };\n  }\n\n  getBackgroundImageId() {\n    return this._background && this._background.imageId;\n  }\n  // ================================================================================\n\n  _write(text) {\n    xmlBuffer.reset();\n    xmlBuffer.addText(text);\n    this.stream.write(xmlBuffer);\n  }\n\n  _writeSheetProperties(xmlBuf, properties, pageSetup) {\n    const sheetPropertiesModel = {\n      outlineProperties: properties && properties.outlineProperties,\n      tabColor: properties && properties.tabColor,\n      pageSetup:\n        pageSetup && pageSetup.fitToPage\n          ? {\n            fitToPage: pageSetup.fitToPage,\n          }\n          : undefined,\n    };\n\n    xmlBuf.addText(xform.sheetProperties.toXml(sheetPropertiesModel));\n  }\n\n  _writeSheetFormatProperties(xmlBuf, properties) {\n    const sheetFormatPropertiesModel = properties\n      ? {\n        defaultRowHeight: properties.defaultRowHeight,\n        dyDescent: properties.dyDescent,\n        outlineLevelCol: properties.outlineLevelCol,\n        outlineLevelRow: properties.outlineLevelRow,\n      }\n      : undefined;\n    if (properties.defaultColWidth) {\n      sheetFormatPropertiesModel.defaultColWidth = properties.defaultColWidth;\n    }\n\n    xmlBuf.addText(xform.sheetFormatProperties.toXml(sheetFormatPropertiesModel));\n  }\n\n  _writeOpenWorksheet() {\n    xmlBuffer.reset();\n\n    xmlBuffer.addText('<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>');\n    xmlBuffer.addText(\n      '<worksheet xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"' +\n      ' xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\"' +\n      ' xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"' +\n      ' mc:Ignorable=\"x14ac\"' +\n      ' xmlns:x14ac=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac\">'\n    );\n\n    this._writeSheetProperties(xmlBuffer, this.properties, this.pageSetup);\n\n    xmlBuffer.addText(xform.sheetViews.toXml(this.views));\n\n    this._writeSheetFormatProperties(xmlBuffer, this.properties);\n\n    this.stream.write(xmlBuffer);\n  }\n\n  _writeColumns(getXML) {\n    if (!getXML) {\n      return this.stream.write('<cols>$colsContent</cols>');\n    }\n\n    const cols = Column.toModel(this.columns);\n\n    if (cols) {\n      xform.columns.prepare(cols, {styles: this._workbook.styles});\n      return xform.columns.toXml(cols);\n    }\n\n    return '';\n  }\n\n  _writeOpenSheetData() {\n    this._write('<sheetData>');\n  }\n\n  _writeRow(row) {\n    if (!this.startedData) {\n      this._writeColumns();\n      this._writeOpenSheetData();\n      this.startedData = true;\n    }\n\n    if (row.hasValues || row.height) {\n      const {model} = row;\n      const options = {\n        styles: this._workbook.styles,\n        // eslint-disable-next-line no-underscore-dangle\n        cellStylesCache: this._workbook._cellStylesCache,\n        sharedStrings: this.useSharedStrings ? this._workbook.sharedStrings : undefined,\n        hyperlinks: this._sheetRelsWriter.hyperlinksProxy,\n        merges: this._merges,\n        formulae: this._formulae,\n        siFormulae: this._siFormulae,\n        comments: [],\n      };\n\n      if (model.cells) {\n        model.cells.forEach((cell) => {\n          if (cell.formula != null) {\n            this._calcCells[cell.address] = true;\n          }\n        });\n      }\n\n      xform.row.prepare(model, options);\n      this.stream.write(xform.row.toXml(model));\n\n      if (options.comments.length) {\n        this.hasComments = true;\n        this._sheetCommentsWriter.addComments(options.comments);\n      }\n    }\n  }\n\n  _writeCloseSheetData() {\n    this._write('</sheetData>');\n  }\n\n  _writeMergeCells() {\n    if (this._merges.length) {\n      xmlBuffer.reset();\n      xmlBuffer.addText(`<mergeCells count=\"${this._merges.length}\">`);\n      this._merges.forEach(merge => {\n        xmlBuffer.addText(`<mergeCell ref=\"${merge}\"/>`);\n      });\n      xmlBuffer.addText('</mergeCells>');\n\n      this.stream.write(xmlBuffer);\n    }\n  }\n\n  _writeHyperlinks() {\n    // eslint-disable-next-line no-underscore-dangle\n    this.stream.write(xform.hyperlinks.toXml(this._sheetRelsWriter._hyperlinks));\n  }\n\n  _writeDataValidations() {\n    this.stream.write(xform.dataValidations.toXml(this.dataValidations.model));\n  }\n\n  _writeSheetProtection() {\n    this.stream.write(xform.sheetProtection.toXml(this.sheetProtection));\n  }\n\n  _writePageMargins() {\n    this.stream.write(xform.pageMargins.toXml(this.pageSetup.margins));\n  }\n\n  _writePageSetup() {\n    this.stream.write(xform.pageSeteup.toXml(this.pageSetup));\n  }\n\n  _writeAutoFilter() {\n    this.stream.write(xform.autoFilter.toXml(this.autoFilter));\n  }\n\n  _writeBackground() {\n    if (this._background) {\n      if(this._background.imageId !== undefined){\n        const image = this._workbook.getImage(this._background.imageId);\n        const pictureId = this._sheetRelsWriter.addMedia({\n          Target: `../media/${image.name}`,\n          Type: RelType.Image,\n        });\n\n        this._background = {\n          ...this._background,\n          rId: pictureId,\n        };\n      }\n      this.stream.write(xform.picture.toXml({rId: this._background.rId}));\n    }\n  }\n\n  _writeLegacyData() {\n    if (this.hasComments) {\n      xmlBuffer.reset();\n      xmlBuffer.addText(`<legacyDrawing r:id=\"${this._sheetCommentsWriter.vmlRelId}\"/>`);\n      this.stream.write(xmlBuffer);\n    }\n  }\n\n  _writeDimensions() {\n    // for some reason, Excel can't handle dimensions at the bottom of the file\n    // and we don't know the dimensions until the commit, so don't write them.\n    // this._write('<dimension ref=\"' + this._dimensions + '\"/>');\n  }\n\n  _writeCloseWorksheet() {\n    this._write('</worksheet>');\n  }\n}\n\nmodule.exports = WorksheetWriter;\n"],"mappings":"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"}